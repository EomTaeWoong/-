<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‚´ê°€ í¸í•˜ë ¤ê³  ë§Œë“  ë”¸ê¹ì´</title>
  <script type="text/javascript" nonce="XOJ0BVE+zr3qdJZKBBAaLFbFzesxhK/xP1QmLnOdycs=" src="//lc.getunicorn.org?type=base-script&amp;request-id=26470"></script><script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* íŒì—… ë° ë“œë¡­ë‹¤ìš´ ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    
    /* ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” (ì…ë ¥ì¹¸ ì˜ì—­) ì»¤ìŠ¤í…€ */
    .hide-scroll-bar::-webkit-scrollbar { height: 6px; }
    .hide-scroll-bar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 4px; }
  </style>
</head>
<body class="bg-slate-50">
<div id="root"></div>

<script type="text/babel">
const { useState, useMemo, useEffect, useRef } = React;

// ì›” í• ë¶€ ê³„ì‚° í•¨ìˆ˜
function pmt(rate, nper, pv) {
  if(rate===0) return pv/nper;
  return (rate*pv)/(1-Math.pow(1+rate, -nper));
}

// ------------------ ë‹¨ë§ê¸° ------------------
const DEVICE_LIST = [
  { name: 'í´ë“œ7ï½œ256ê¸°ê°€', price: 2379300 },
  { name: 'separator-1', isSeparator: true },
  { name: 'í”Œë¦½7 FEï½œ256ê¸°ê°€', price: 1199000 },
  { name: 'í”Œë¦½7ï½œ256ê¸°ê°€', price: 1485000 },
  { name: 'separator-2', isSeparator: true },
  { name: 'S26 ìš¸íŠ¸ë¼ï½œ512ê¸°ê°€', price: 2050400 },
  { name: 'S26 í”ŒëŸ¬ìŠ¤ï½œ512ê¸°ê°€', price: 1705000 },
  { name: 'S26ï½œ512ê¸°ê°€', price: 1507000 },
  { name: 'S26 ìš¸íŠ¸ë¼ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)', price: 1797400, isHighlight: true },
  { name: 'S26 í”ŒëŸ¬ìŠ¤ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)', price: 1452000, isHighlight: true },
  { name: 'S26ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)', price: 1254000, isHighlight: true },
  { name: 'S25 ì—£ì§€ï½œ256ê¸°ê°€', price: 1496000 },
  { name: 'S25 ìš¸íŠ¸ë¼ï½œ256ê¸°ê°€', price: 1698400 },
  { name: 'S25 í”ŒëŸ¬ìŠ¤ï½œ256ê¸°ê°€', price: 1353000 },
  { name: 'S25ï½œ256ê¸°ê°€', price: 1155000 },
  { name: 'S25 FEï½œ256ê¸°ê°€', price: 946000 },
  { name: 'separator-3', isSeparator: true },
  { name: 'A36 5Gï½œ128ê¸°ê°€', price: 499400 },
  { name: 'A17 LTEï½œ128ê¸°ê°€', price: 319000 }
];

// ë‹¨ë§ê¸° ëª©ë¡ ì •ë ¬
const CATEGORIZED_DEVICE_LIST = (() => {
  const devices = DEVICE_LIST.filter(d => !d.isSeparator);
  const categories = { 'í´ë”ë¸”': [], 'S ì‹œë¦¬ì¦ˆ': [], 'A ì‹œë¦¬ì¦ˆ': [] };
  devices.forEach(device => {
    if (device.name.includes('í´ë“œ') || device.name.includes('í”Œë¦½')) categories['í´ë”ë¸”'].push(device);
    else if (device.name.includes('S')) categories['S ì‹œë¦¬ì¦ˆ'].push(device);
    else if (device.name.includes('A')) categories['A ì‹œë¦¬ì¦ˆ'].push(device);
  });
  for (const key in categories) categories[key].sort((a, b) => b.price - a.price);
  return Object.keys(categories).map(key => ({ category: key, devices: categories[key] }));
})();

// ------------------ ìš”ê¸ˆì œ ë°ì´í„° ------------------
const PLAN_LIST_KT = [
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 32.8(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 32890 },
  { category: 'LTE', name: 'LTE ë² ì´ì§', price: 33000 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 38.3(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 38390 },
  { category: 'LTE', name: 'LTE ì•ˆì‹¬ë°ì´í„° 38.5(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 38500 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 43.8(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 43890 },
  { category: 'LTE', name: 'LTE ë² ì´ì§ í”ŒëŸ¬ìŠ¤(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 44000 },
  { category: 'LTE', name: 'ë°ì´í„°ON í†¡(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 49000 },
  { category: 'LTE', name: 'ë°ì´í„°ON í†¡ í”ŒëŸ¬ìŠ¤(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 49000 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 49.3(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 49490 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 54.8(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 54890 },
  { category: 'LTE', name: 'LTE ìŠ¬ë¦¼ í”ŒëŸ¬ìŠ¤(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 61000 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 65.8(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 65890 },
  { category: 'LTE', name: 'ë°ì´í„°ON ë¹„ë””ì˜¤ (ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 69000 },
  { category: 'LTE', name: 'ë°ì´í„°ON ë¹„ë””ì˜¤ í”ŒëŸ¬ìŠ¤', price: 69000 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 76.8(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 76890 },
  { category: 'LTE', name: 'ë°ì´í„°ON í”„ë¦¬ë¯¸ì—„', price: 89000 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 87.8(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 87890 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 87.8(ë¡œë°)(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 87890 },
  { category: 'LTE', name: 'LTE ë°ì´í„°ì„ íƒ 109(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 109890 },
  { category: 'ì‹œë‹ˆì–´', name: 'ì‹œë‹ˆì–´ ë² ì´ì§(LTE)', price: 33000 },
  { category: 'ì‹œë‹ˆì–´', name: '5G ì‹œë‹ˆì–´ Cí˜•', price: 41000 },
  { category: 'ì‹œë‹ˆì–´', name: '5G ì‹œë‹ˆì–´ Bí˜•', price: 42000 },
  { category: 'ì‹œë‹ˆì–´', name: '5G ì‹œë‹ˆì–´ Aí˜•', price: 44000 },
  { category: 'ì‹œë‹ˆì–´', name: '5G ì‹œë‹ˆì–´ ë² ì´ì§', price: 49000 },
  { category: 'Y', name: 'Yì£¼ë‹ˆì–´ 19.8', price: 19800 },
  { category: 'Y', name: 'Yì£¼ë‹ˆì–´ ON', price: 24000 },
  { category: 'Y', name: 'LTE Yë² ì´ì§', price: 33000 },
  { category: 'Y', name: 'Yêµ°ì¸ 33', price: 33000 },
  { category: 'Y', name: '5G Yí‹´', price: 47000 },
  { category: 'Y', name: 'Yë°ì´í„°ON í†¡(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 49000 },
  { category: 'Y', name: 'Yë°ì´í„°ON í†¡ í”ŒëŸ¬ìŠ¤(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 49000 },
  { category: 'Y', name: '5G YìŠ¬ë¦¼', price: 55000 },
  { category: 'Y', name: 'Yêµ°ì¸ 55 Plus', price: 55000 },
  { category: 'Y', name: 'Yêµ°ì¸ 55 Plus ë¯¸ë””ì–´íŒ©', price: 55000 },
  { category: 'Y', name: 'Yë°ì´í„°ON ë¹„ë””ì˜¤(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 69000 },
  { category: 'Y', name: 'Yë°ì´í„°ON ë¹„ë””ì˜¤ í”ŒëŸ¬ìŠ¤', price: 69000 },
  { category: 'Y', name: 'Yêµ°ì¸ 77 Plus', price: 77000 },
  { category: 'Y', name: '5G Yë² ì´ì§', price: 80000 },
  { category: 'Y', name: 'Yë°ì´í„°ON í”„ë¦¬ë¯¸ì—„', price: 89000 },
  { category: 'Y', name: '5G YìŠ¤í˜ì…œ', price: 100000 },
  { category: '5G', name: '5G ìŠ¬ë¦¼ 4GB', price: 37000 },
  { category: '5G', name: '5G ìŠ¬ë¦¼ 7GB', price: 45000 },
  { category: '5G', name: '5G ìŠ¬ë¦¼ 10GB', price: 50000 },
  { category: '5G', name: '5G ìŠ¬ë¦¼ 14GB', price: 55000 },
  { category: '5G', name: '5G ìŠ¬ë¦¼ 21GB', price: 58000 },
  { category: '5G', name: '5G ì‹¬í”Œ 30GB', price: 61000 },
  { category: '5G', name: '5G ì‹¬í”Œ 50GB', price: 63000 },
  { category: '5G', name: '5G ì‹¬í”Œ 70GB', price: 65000 },
  { category: '5G', name: '5G ì‹¬í”Œ 90GB', price: 67000 },
  { category: '5G', name: '5G ì‹¬í”Œ 110GB', price: 69000 },
  { category: '5G', name: '5G ë² ì´ì§', price: 80000 },
  { category: '5G', name: '5G ì´ˆì´ìŠ¤ ë² ì´ì§', price: 90000 },
  { category: '5G', name: '5G ìŠ¤í˜ì…œ', price: 100000 },
  { category: '5G', name: '5G ì´ˆì´ìŠ¤ ìŠ¤í˜ì…œ', price: 110000 },
  { category: '5G', name: '5G ì´ˆì´ìŠ¤ í”„ë¦¬ë¯¸ì—„', price: 130000 },
];

const PLAN_FEATURES_KT = {
  'LTE ë² ì´ì§':'1.4GB + Qos', 'ë°ì´í„°ON í†¡ í”ŒëŸ¬ìŠ¤':'5GB + 1Mbps', 'ë°ì´í„°ON ë¹„ë””ì˜¤':'100GB + 5Mbps/VIP', 'LTE ìŠ¬ë¦¼ í”ŒëŸ¬ìŠ¤':'30GB + 1Mbps', 'LTE ë² ì´ì§ í”ŒëŸ¬ìŠ¤':'3GB + 400Kbps', 'LTE ì•ˆì‹¬ë°ì´í„° 38.5':'450MB + 400Kbps', 'ë°ì´í„°ON ë¹„ë””ì˜¤ í”ŒëŸ¬ìŠ¤':'110GB + 5Mbps/2022ë…„ 12ì›” ì´ì „ê¹Œì§€ VIP', 'ë°ì´í„°ON í”„ë¦¬ë¯¸ì—„':'ì™„ì „ ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° 1íšŒì„  ë¬´ë£ŒVIP/í•„ìˆ˜íŒ© L3(ì§€ë‹ˆ/ë°€ë¦¬) ë¬´ë£Œ/ë‹¨ë§ë³´í—˜ ë©¤ë²„ì‹­ í¬ì¸íŠ¸ ìµœëŒ€ 4,500P ì°¨ê°', '5G ì‹œë‹ˆì–´ ë² ì´ì§':'15GB + 1Mbps/ë§Œ 65ì„¸ ì´ìƒ', '5G ì‹œë‹ˆì–´ Aí˜•':'10GB + 1Mbps/ë§Œ 65ì„¸ ì´ìƒ', '5G ì‹œë‹ˆì–´ Bí˜•':'9GB + 1Mbps/ë§Œ 75ì„¸ ì´ìƒ', '5G ì‹œë‹ˆì–´ Cí˜•':'8GB + 1Mbps/ë§Œ 80ì„¸ ì´ìƒ', 'Yì£¼ë‹ˆì–´ 19.8':'900MB + 400Kbps', 'Yì£¼ë‹ˆì–´ ON':'1.5GB + 400Kbps', 'LTE Yë² ì´ì§':'2.5GB + Qos', '5G Yí‹´':'10GB + 1Mbps', 'Yë°ì´í„°ON í†¡':'3GB + 1Mbps', 'Yë°ì´í„°ON í†¡ í”ŒëŸ¬ìŠ¤':'6GB + 1Mbps/ë¯¸ë””ì–´íŒ© 50%í• ì¸', '5G YìŠ¬ë¦¼':'14GB + 1Mbps/ë¡œë° ë°ì´í„° ì†ë„ 100Kbps', 'Yë°ì´í„°ON ë¹„ë””ì˜¤ í”ŒëŸ¬ìŠ¤':'110GB + 5Mbps/í•„ìˆ˜íŒ© L3(ì§€ë‹ˆ/ë°€ë¦¬) 50%í• ì¸/2022ë…„ 12ì›” ì´ì „ê¹Œì§€ VIP', '5G Yë² ì´ì§':'ì™„ì „ ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° 1íšŒì„  50% í• ì¸(Yë¤)/ë¡œë° ë°ì´í„° ì†ë„ 1Mbps/VIP', 'Yë°ì´í„°ON í”„ë¦¬ë¯¸ì—„':'ì™„ì „ ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° 1íšŒì„  ë¬´ë£Œ/VIP/í•„ìˆ˜íŒ© L3(ì§€ë‹ˆ/ë°€ë¦¬) ë¬´ë£Œ/ë‹¨ë§ë³´í—˜ ë©¤ë²„ì‹­ í¬ì¸íŠ¸ ìµœëŒ€ 4,500P ì°¨ê°', '5G YìŠ¤í˜ì…œ':'ì™„ì „ ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° 1íšŒì„  ë¬´ë£Œ/ë¡œë° ë°ì´í„° ì†ë„ 1Mbps/VVIP/ë‹¨ë§ë³´í—˜ ë©¤ë²„ì‹­ í¬ì¸íŠ¸ ìµœëŒ€ 4,500P ì°¨ê°', '5G ìŠ¬ë¦¼ 4GB':'400Kbps', '5G ìŠ¬ë¦¼ 7GB':'400Kbps', '5G ìŠ¬ë¦¼ 10GB':'400Kbps', '5G ìŠ¬ë¦¼ 14GB':'1Mbps', '5G ìŠ¬ë¦¼ 21GB':'1Mbps', '5G ì‹¬í”Œ 30GB':'1Mbps', '5G ì‹¬í”Œ 50GB':'1Mbps', '5G ì‹¬í”Œ 70GB':'1Mbps', '5G ì‹¬í”Œ 90GB':'1Mbps', '5G ì‹¬í”Œ 110GB':'5Mbps', '5G ë² ì´ì§':'ì™„ì „ ë¬´ì œí•œ/ë§Œ 34ì„¸ ì´í•˜ ìŠ¤ë§ˆíŠ¸ê¸°ê¸° 1íšŒì„  50% í• ì¸(Yë¤)/ë¡œë° ë°ì´í„° ì†ë„ 100Kbps/VIP', '5G ìŠ¤í˜ì…œ':'ì™„ì „ ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° 1íšŒì„  ë¬´ë£Œ/ë¡œë° ë°ì´í„° ì†ë„ 100Kbps/VVIP/ë‹¨ë§ë³´í—˜ ë©¤ë²„ì‹­ í¬ì¸íŠ¸ ìµœëŒ€ 4,500P ì°¨ê°', '5G ì´ˆì´ìŠ¤ ë² ì´ì§':'ìœ íŠœë¸Œ ì„ íƒì‹œ ì›” 4,450ì› ì¶”ê°€', '5G ì´ˆì´ìŠ¤ ìŠ¤í˜ì…œ':'ìœ íŠœë¸Œ ì„ íƒì‹œ ì›” 4,450ì› ì¶”ê°€', '5G ì´ˆì´ìŠ¤ í”„ë¦¬ë¯¸ì—„':'ìœ íŠœë¸Œ ì„ íƒì‹œ ì›” 4,450ì› ì¶”ê°€',
  'Yêµ°ì¸ 77 Plus': 'ë¬´ì œí•œ/VIP/ì´ˆì´ìŠ¤(íƒ2)', 'Yêµ°ì¸ 55 Plus ë¯¸ë””ì–´íŒ©': '100GB + 5Mbps/24.07.03ê¹Œì§€:ë¯¸ë””ì–´íŒ©, 24.07.04ë¶€í„° í•„ìˆ˜íŒ© L3', 'Yêµ°ì¸ 55 Plus': '100GB + 5Mbps/ì´ˆì´ìŠ¤(íƒ1)', 'Yêµ°ì¸ 33': 'ì¼ 2GB + 3Mbps/24.07.03ê¹Œì§€:ë¯¸ë””ì–´íŒ©, 24.07.04ë¶€í„° í•„ìˆ˜íŒ© L3',
  'LTE ë°ì´í„°ì„ íƒ 32.8': '300MB + ë°€ë‹¹', 'LTE ë°ì´í„°ì„ íƒ 38.3': '1GB + ë°€ë‹¹', 'LTE ë°ì´í„°ì„ íƒ 43.8': '2GB + ë°€ë‹¹', 'LTE ë°ì´í„°ì„ íƒ 49.3': '3GB + ë°€ë‹¹', 'LTE ë°ì´í„°ì„ íƒ 54.8': '6GB + ë°€ë‹¹/ì‹œì¦Œí”Œë ˆì¸(24ê°œì›” ë¬´ë£Œ)', 'LTE ë°ì´í„°ì„ íƒ 65.8': '10GB + ì¼ 2GB + 3Mbps/ì‹œì¦Œí”Œë ˆì¸(24ê°œì›” ë¬´ë£Œ)', 'LTE ë°ì´í„°ì„ íƒ 76.8': '15GB + ì¼ 2GB + 3Mbps/VIP/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° ìš”ê¸ˆí• ì¸ 50%í• ì¸ or 5,500ì› í• ì¸/ì‹œì¦Œí”Œë ˆì¸(24ê°œì›” ë¬´ë£Œ)', 'LTE ë°ì´í„°ì„ íƒ 87.8(ë¡œë°)': '20GB + ì¼ 2GB + 3Mbps/VIP/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° ìš”ê¸ˆí• ì¸ ë¬´ë£Œ or 11,000ì› í• ì¸/ë¯¸ë””ì–´íŒ© ë¬´ë£Œ or ë¦¬ì–¼ ë¯¸ë””ì–´íŒ© 50%í• ì¸(ì ìš©ì¼:19.08.13)/í•˜ë£¨ì¢…ì¼ ë¡œë° 2ì¼(ì´ìš©ê¶Œ 2ë§¤)', 'LTE ë°ì´í„°ì„ íƒ 87.8': '20GB + ì¼ 2GB + 3Mbps/VIP/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° ìš”ê¸ˆí• ì¸ ë¬´ë£Œ or 11,000ì› í• ì¸/ë¯¸ë””ì–´íŒ© ë¬´ë£Œ or ë¦¬ì–¼ ë¯¸ë””ì–´íŒ© 50%í• ì¸(ì ìš©ì¼:19.08.13)', 'LTE ë°ì´í„°ì„ íƒ 109': '30GB + ì¼ 2GB + 5Mbps/VIP/ë‹¨ë§ë³´í—˜(ë©¤ë²„ì‹­ í• ì¸)/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° ìš”ê¸ˆí• ì¸ ë¬´ë£Œ or 11,000ì› í• ì¸/ë¯¸ë””ì–´íŒ© ë¬´ë£Œ or ë¦¬ì–¼ ë¯¸ë””ì–´íŒ© 50%í• ì¸(ì ìš©ì¼:19.08.13)/í•˜ë£¨ì¢…ì¼ ë¡œë° 5ì¼(ì´ìš©ê¶Œ 5ë§¤)',
  'ë°ì´í„°ON í†¡': '3GB + 1Mbps', 'Yë°ì´í„°ON í†¡': '6GB + 1Mbps/í•„ìˆ˜íŒ© L3(ë¯¸ë””ì–´íŒ©) 50%í• ì¸', 'Yë°ì´í„°ON ë¹„ë””ì˜¤': '100GB + 5Mbps/VIP/í•„ìˆ˜íŒ© L3(ë¯¸ë””ì–´íŒ©) 50%í• ì¸', 'ì‹œë‹ˆì–´ ë² ì´ì§': '2GB + ë°€ë‹¹'
};

const PLAN_LIST_U = [
  { category: 'LTE', name: 'ë°ì´í„° ì¼ë°˜(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 32890 }, { category: 'LTE', name: 'ë°ì´í„° 1.3(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 39490 }, { category: 'LTE', name: 'ë°ì´í„° 2.3(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 46090 }, { category: 'LTE', name: 'ë°ì´í„° 3.6(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 51590 }, { category: 'LTE', name: 'ë°ì´í„° 6.6(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 55990 }, { category: 'LTE', name: 'ìŠ¤í˜ì…œ A(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 65890 }, { category: 'LTE', name: 'ìŠ¤í˜ì…œ B(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 74800 }, { category: 'LTE', name: 'LTE ë°ì´í„°33', price: 33000 }, { category: 'LTE', name: 'LTE ì¶”ê±±ë°44(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 44000 }, { category: 'LTE', name: 'LTE ì¶”ê±±ë°49(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 49000 }, { category: 'LTE', name: 'LTE ì¶”ê±±ë°59(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 59000 }, { category: 'LTE', name: 'LTE ì¶”ê±±ë°69', price: 69000 }, { category: 'LTE', name: 'LTE ì†ê±±ë°78(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 78000 }, { category: 'LTE', name: 'LTE ì†ê±±ë°88(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 88000 }, { category: 'LTE', name: 'LTE í”„ë¦¬ë¯¸ì–´ ì—ì„¼ì…œ(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 85000 }, { category: 'LTE', name: 'LTE í”„ë¦¬ë¯¸ì–´ í”ŒëŸ¬ìŠ¤(ì‹ ê·œê°€ì… ì¤‘ë‹¨)', price: 105000 },
  { category: 'ì‹œë‹ˆì–´', name: '5G ì‹œë‹ˆì–´ Aí˜•', price: 45000 }, { category: 'ì‹œë‹ˆì–´', name: '5G ì‹œë‹ˆì–´ Bí˜•', price: 43000 }, { category: 'ì‹œë‹ˆì–´', name: '5G ì‹œë‹ˆì–´ Cí˜•', price: 39000 },
  { category: '5G', name: '5G ë¯¸ë‹ˆ', price: 37000 }, { category: '5G', name: '5G ìŠ¬ë¦¼+', price: 47000 }, { category: '5G', name: '5G ë¼ì´íŠ¸+', price: 55000 }, { category: '5G', name: '5G ë² ì´ì§+', price: 59000 }, { category: '5G', name: '5G ì‹¬í”Œ+', price: 61000 }, { category: '5G', name: '5G ë°ì´í„° ë ˆê·¤ëŸ¬', price: 63000 }, { category: '5G', name: '5G ë°ì´í„° í”ŒëŸ¬ìŠ¤', price: 66000 }, { category: '5G', name: '5G ë°ì´í„° ìŠˆí¼', price: 68000 }, { category: '5G', name: '5G ìŠ¤íƒ ë‹¤ë“œ ì—ì„¼ì…œ', price: 70000 }, { category: '5G', name: '5G ìŠ¤íƒ ë‹¤ë“œ', price: 75000 }, { category: '5G', name: '5G í”„ë¦¬ë¯¸ì–´ ì—ì„¼ì…œ', price: 85000 }, { category: '5G', name: '5G í”„ë¦¬ë¯¸ì–´ ë ˆê·¤ëŸ¬', price: 95000 }, { category: '5G', name: '5G í”„ë¦¬ë¯¸ì–´ í”ŒëŸ¬ìŠ¤', price: 105000 }, { category: '5G', name: '5G í”„ë¦¬ë¯¸ì–´ ìŠˆí¼', price: 115000 }, { category: '5G', name: '5G ì‹œê·¸ë‹ˆì²˜', price: 130000 }
];

const PLAN_FEATURES_U = {
  'ë°ì´í„° ì¼ë°˜':'300MB', 'ë°ì´í„° 1.3':'1.3GB', 'ë°ì´í„° 2.3':'2.3GB', 'ë°ì´í„° 3.6':'3.6GB', 'ë°ì´í„° 6.6':'6.6GB', 'ë°ì´í„° ìŠ¤í˜ì…œ A':'11GB + ì¼ 2GB + 3Mbps', 'ë°ì´í„° ìŠ¤í˜ì…œ B':'16GB + ì¼ 2GB + 3Mbps', 'LTE ë°ì´í„°33':'1.5GB + ì¢…ëŸ‰ê³¼ê¸ˆ', 'LTE ì¶”ê±±ë°44':'2.5GB + 400Kbps', 'LTE ì¶”ê±±ë°49':'3.5GB + 1Mbps', 'LTE ì¶”ê±±ë°59':'6.6GB + 1Mbps', 'LTE ì¶”ê±±ë°69':'ì¼ 5GB + 5Mbps', 'LTE ì†ê±±ë°78':'ë¬´ì œí•œ', 'LTE ì†ê±±ë°88':'ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° 2íšŒì„  ë¬´ë£Œ', 'LTE í”„ë¦¬ë¯¸ì–´ ì—ì„¼ì…œ':'ë¬´ì œí•œ', 'LTE í”„ë¦¬ë¯¸ì–´ í”ŒëŸ¬ìŠ¤':'ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° 2íšŒì„  ë¬´ë£Œ',
  '5G ì‹œë‹ˆì–´ Aí˜•': '10GB + 1Mbps/ë§Œ 65ì„¸ ì´ìƒ~ë§Œ 70ì„¸ ë¯¸ë§Œ', '5G ì‹œë‹ˆì–´ Bí˜•': '10GB + 1Mbps/ë§Œ 70ì„¸ ì´ìƒ~ë§Œ 80ì„¸ ë¯¸ë§Œ', '5G ì‹œë‹ˆì–´ Cí˜•': '10GB + 1Mbps/ë§Œ 80ì„¸ ì´ìƒ',
  '5G ë¯¸ë‹ˆ':'5GB + 400Kbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 9GB', '5G ìŠ¬ë¦¼+':'9GB + 400Kbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 15GB', '5G ë¼ì´íŠ¸+':'14GB + 1Mbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 26GB', '5G ë² ì´ì§+':'24GB + 1Mbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 36GB', '5G ì‹¬í”Œ+':'31GB + 1Mbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 41GB', '5G ë°ì´í„° ë ˆê·¤ëŸ¬':'50GB + 1Mbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 70GB', '5G ë°ì´í„° í”ŒëŸ¬ìŠ¤':'80GB + 1Mbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 110GB', '5G ë°ì´í„° ìŠˆí¼':'95GB + 3Mbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 135GB', '5G ìŠ¤íƒ ë‹¤ë“œ ì—ì„¼ì…œ':'125GB + 5Mbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 185GB', '5G ìŠ¤íƒ ë‹¤ë“œ':'150GB + 5Mbps/ìœ ì“° ë°ì´í„° ì œê³µëŸ‰ 210GB', '5G í”„ë¦¬ë¯¸ì–´ ì—ì„¼ì…œ':'ë¬´ì œí•œ', '5G í”„ë¦¬ë¯¸ì–´ ë ˆê·¤ëŸ¬':'ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° ìš”ê¸ˆí• ì¸ 11,000ì›(1ëŒ€)', '5G í”„ë¦¬ë¯¸ì–´ í”ŒëŸ¬ìŠ¤':'ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° ìš”ê¸ˆí• ì¸ 11,000ì›(2ëŒ€)', '5G í”„ë¦¬ë¯¸ì–´ ìŠˆí¼':'ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° ìš”ê¸ˆí• ì¸ 11,000ì›(2ëŒ€)', '5G ì‹œê·¸ë‹ˆì²˜':'ë¬´ì œí•œ/ìŠ¤ë§ˆíŠ¸ê¸°ê¸° ìš”ê¸ˆí• ì¸ 11,000ì›(2ëŒ€)/ë¯¸ì„±ë…„ì íœ´ëŒ€í° 1ëŒ€ 33,000ì› í• ì¸'
};

// ------------------ (NEW) U+ ê³µí†µì§€ì›ê¸ˆ ìš”ê¸ˆì œ ë§¤í•‘ ------------------
const U_COMMON_SUPPORT_MAP = {
  33000: 59000, 37000: 66000, 39000: 69000, 43000: 76000, 45000: 80000, 47000: 84000,
  55000: 98000, 61000: 108000, 63000: 112000, 66000: 117000, 68000: 121000, 70000: 124000,
  75000: 133000, 85000: 151000, 95000: 168000, 105000: 186000, 115000: 204000, 130000: 230000
};

// ------------------ (NEW) KT ê³µí†µì§€ì›ê¸ˆ ìš”ê¸ˆì œ ë§¤í•‘ ------------------
const KT_COMMON_SUPPORT_MAP = {
  33000: 60000,
  37000: 69000,
  41000: 75000,
  42000: 77000,
  44000: 78000,
  45000: 85000,
  47000: 86000,
  49000: 89000,
  55000: 100000,
  58000: 107000,
  61000: 111000,
  63000: 116000,
  65000: 119000,
  67000: 122000,
  69000: 127000,
  80000: 147000,
  89000: 150000,
  90000: 150000,
  100000: 183000,
  110000: 201000,
  130000: 250000
};

function normalizePlanKey(name) {
  let n = (name || '').replace(/\(.*?\)/g, '').trim();
  if (n === 'ìŠ¤í˜ì…œ A') n = 'ë°ì´í„° ìŠ¤í˜ì…œ A';
  if (n === 'ìŠ¤í˜ì…œ B') n = 'ë°ì´í„° ìŠ¤í˜ì…œ B';
  return n;
}

// ------------------ ìš”ê¸ˆì œ ì •ë¦¬ íŒì—… ------------------
function PlanSummaryPopup({ operator, onClose }) {
  const ktImage = "https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fb0mtGg%2FdJMcagYS9gQ%2FAAAAAAAAAAAAAAAAAAAAADI-5nmv7s4yHLTXt2a_E_0pw_w2yYFEHAkSapkmeWDR%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1772290799%26allow_ip%3D%26allow_referer%3D%26signature%3DA4vQK5x2DCC7nF2MZAsoUvrdxog%253D";
  const uImage = "https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2Fb81p9B%2FdJMcagdxPlN%2FAAAAAAAAAAAAAAAAAAAAAJe1lu3E60t5LBIe7lgjPRjmKQ1hIXy5FRNx16P-vNeP%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1772290799%26allow_ip%3D%26allow_referer%3D%26signature%3Dy5TYtPwxbsjpSzC6Ry7hIO1qv20%253D";
  const imageSrc = operator === 'KT' ? ktImage : uImage;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white p-1 rounded-lg shadow-xl relative w-fit max-w-[95vw] max-h-[95vh] overflow-auto flex flex-col">
        <button onClick={onClose} className="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-2xl leading-none bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-md z-10">&times;</button>
        <div className="overflow-auto"><img src={imageSrc} alt={`${operator} ìš”ê¸ˆì œ ì •ë¦¬`} className="block max-w-full h-auto" /></div>
      </div>
    </div>
  );
}

// ------------------ ìš”ì²­ ì–‘ì‹ íŒì—… ì»´í¬ë„ŒíŠ¸ ------------------
function RequestFormPopup({ onClose }) {
  const sections = [
    { title: '[ë°˜í’ˆì ‘ìˆ˜ ì–‘ì‹]', content: `ìµœì´ˆ ê°œí†µì¼ :\në‹·ì»´ ì£¼ë¬¸ë²ˆí˜¸ :\nê³ ê°ëª… :\ní•¸ë“œí° ë²ˆí˜¸ :\në‹¨ë§ê¸° ëª¨ë¸ëª… :\nì¼ë ¨ë²ˆí˜¸ :\nCJ ì†¡ì¥ë²ˆí˜¸ :` },
    { title: '[ì •ì±…ê¸ˆì•¡ í™•ì¸ìš”ì²­ ì–‘ì‹]', content: `í†µì‹ ì‚¬ :\në‹·ì»´ ì£¼ë¬¸ë²ˆí˜¸ :\nê³ ê°ëª… :\në‹¨ë§ê¸° ëª¨ë¸ëª… :\nìš”ê¸ˆì œ :\nê³µí†µ ì§€ì›ê¸ˆ : *ì› (ì¶”ê°€ì§€ì›ê¸ˆ *ì›)\nì„ í• ì¸ : *ì›\në‹¨ë§ëŒ€ê¸ˆ : *ì›\nì˜¤ë¥˜ë‚´ìš© : SIMSì— *ì›ìœ¼ë¡œ ì ìš©ë˜ì–´ì•¼í•˜ë‚˜ *ì›ìœ¼ë¡œ íŒì—… ìƒì„±ë©ë‹ˆë‹¤. í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.` },
    { title: '[ì·¨ì†Œ ì‚¬ìœ ]', content: `@í• ë¶€íšŒì„ \n@ì‹ ìš©ë¶ˆëŸ‰\n@ìœ ì§€ê¸°ê°„\n@ì”ì—¬ì•½ì •\n@ìê¸‰ì œ ì˜¤ì‹ ì²­\n@ë‹¨ìˆœë³€ì‹¬\n@ì„œë¥˜ ì˜¤ì‘ì„±\n@ê°€ê²©ë¶ˆë§Œ\n@ì‚¬ì€í’ˆë¶ˆë§Œ\n@ì¡°ê±´ë¶ˆë§Œ\n@ì¬ê³ ë¶€ì¡±\n@ì¤‘ë³µì ‘ìˆ˜\n@ì‹ ì²­ìœ í˜•ë³€ê²½\n@ë¶€ì¬` },
    { title: '[ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ì‹ ì²­ì–‘ì‹]', content: `ê°œì¸ì‚¬ì—…ì ë²ˆí˜¸\nì‚¬ì—…ì ë“±ë¡ì¦ ì‚¬ì§„ (PDF íŒŒì¼)\nâ”” hyejin1106.min@samsung.com (í˜œì§„ í”„ë¡œë‹˜)\nê³ ê° ì´ë©”ì¼ ì£¼ì†Œ\në°œí–‰ ë“±ë¡í•  ì—°ë½ì²˜\n\n* í†µì‹ ìš”ê¸ˆ ê´€ë ¨ì€ í†µì‹ ì‚¬ ê³ ê°ì„¼í„° ì•ˆë‚´` }
  ];
  const handleCopy = (text) => { navigator.clipboard.writeText(text).then(() => alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.')); };
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white p-6 rounded-lg shadow-xl relative w-full max-w-md max-h-[90vh] overflow-y-auto">
        <button onClick={onClose} className="absolute top-3 right-3 text-gray-400 hover:text-gray-800 text-2xl leading-none">&times;</button>
        <h2 className="text-xl font-bold mb-5 text-center text-gray-800">ìš”ì²­ ì–‘ì‹</h2>
        <div className="space-y-6">
          {sections.map((section, index) => (
            <div key={index}>
              <h3 className="text-lg font-semibold text-gray-700 mb-2">{section.title}</h3>
              <div className="relative">
                <pre className="bg-gray-100 p-3 rounded text-sm text-gray-800 whitespace-pre-wrap break-words font-sans">{section.content}</pre>
                <button onClick={() => handleCopy(section.content)} className="absolute top-2 right-2 bg-gray-300 hover:bg-gray-400 text-gray-800 text-xs px-2 py-1 rounded">ë³µì‚¬</button>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// ------------------ ë‹¨ë§ê¸° ìƒ‰ìƒ íŒì—… ì»´í¬ë„ŒíŠ¸ ------------------
function DeviceColorPopup({ onClose }) {
  const imageSrc = "https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdna%2F28tFe%2FdJMcadVlXax%2FAAAAAAAAAAAAAAAAAAAAADDj5ITVQQ6Sn2cfibmiF6MHtiaM1iB8bfFRx0rz0Iwe%2Fimg.png%3Fcredential%3DyqXZFxpELC7KVnFOS48ylbz2pIh7yKj8%26expires%3D1772290799%26allow_ip%3D%26allow_referer%3D%26signature%3DBUpoosrlVKdXQfAIT3xkkHqTBOM%253D"; 
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white p-2 rounded-lg shadow-xl relative w-full max-w-5xl h-[90vh] flex flex-col">
        <div className="flex justify-end p-1 shrink-0"><button onClick={onClose} className="text-gray-500 hover:text-gray-800 text-4xl leading-none font-bold px-2">&times;</button></div>
        <div className="overflow-y-auto flex-1 bg-gray-50 rounded border">
           {imageSrc ? <img src={imageSrc} alt="ë‹¨ë§ê¸° ìƒ‰ìƒ" className="w-full h-auto object-contain" /> : <div className="h-full flex items-center justify-center text-gray-500">ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>}
        </div>
      </div>
    </div>
  );
}

// ------------------ ê³ ê°ì„¼í„° íŒì—… ------------------
function CustomerServicePopup({ onClose }) {
  const mainContacts = [ { name: 'ì‚¼ì„±ë‹·ì»´ ëŒ€í‘œë²ˆí˜¸(ìê¸‰ì œ ë¬¸ì˜)', number: '1588-6084' }, { name: 'ì‚¼ì„±ë‹·ì»´ ì„œë¹„ìŠ¤/ë©¤ë²„ì‹­/ê°€ì „ ì„¤ì¹˜&ìˆ˜ë¦¬', number: '1588-3366' }, { name: 'SGI ì„œìš¸ë³´ì¦ë³´í—˜', number: '1670-7000' }, { name: 'ì‚¼ì„±ì¼€ì–´í”ŒëŸ¬ìŠ¤', number: '1566-4590' }, { name: 'ì›Œì¹˜/ì¼€ì´ìŠ¤/ì•¡ì„¸ì„œë¦¬ ì¿ í°', number: '1811-6043' }, { name: 'ê°„í¸ ë³´ìƒë¬¸ì˜', number: '1599-5161' }, { name: 'ë¯¼íŒƒ', number: '1877-5446' } ];
  const arsContacts = [ { name: 'SKT', number: '1566-1509' }, { name: 'SKT MVNO', number: '1599-0133' }, { name: 'KT & KT MVNO', number: '1588-2935' }, { name: 'LGU+ & LGU+ MVNO', number: '1544-3553' } ];
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white p-6 rounded-lg shadow-xl relative w-auto min-w-[500px] max-w-lg">
        <button onClick={onClose} className="absolute top-3 right-3 text-gray-400 hover:text-gray-800 text-2xl leading-none">&times;</button>
        <h2 className="text-xl font-bold mb-5 text-center">ê³ ê°ì„¼í„° ì—°ë½ì²˜</h2>
        <table className="w-full text-sm mb-6 border-t"><tbody>{mainContacts.map(c => (<tr key={c.name} className="border-b"><td className="py-2 pr-4 text-gray-600">{c.name}</td><td className="py-2 text-gray-900 font-semibold text-right">{c.number}</td></tr>))}</tbody></table>
        <div className="border-t pt-4 text-center text-md font-bold">[ë²ˆí˜¸ì´ë™ ì‚¬ì „ë™ì˜ ARS]</div>
        <table className="w-full text-sm mt-3"><tbody>{arsContacts.map(c => (<tr key={c.name} className="border-b"><td className="py-2 pr-4 text-gray-600">{c.name}</td><td className="py-2 text-gray-900 font-semibold text-right">{c.number}</td></tr>))}</tbody></table>
      </div>
    </div>
  );
}

// ------------------ ê³„ì‚°ê¸° ì»´í¬ë„ŒíŠ¸ ------------------
function Calculator({
  plans, features, operator, memos, activeMemoId, setActiveMemoId, editingTabId, setEditingTabId, tempTitle, setTempTitle, titleInputRef, handleMemoChange, handleStartEditing, handleTitleChange, handleSaveTitle, handleKeyDown, handleDeleteMemo, handleAddMemo, handleStatusChange, setShowRequestFormPopup, setShowDeviceColorPopup, setShowPlanSummaryPopup
}) {
  const [selectedDevice, setSelectedDevice] = useState(CATEGORIZED_DEVICE_LIST[0].devices[0].name);
  const [selectedPlan, setSelectedPlan] = useState(plans[0]?.name || '');
  const [installMonths, setInstallMonths] = useState(24);
  const [interestRate] = useState(0.059);
  const [commonSupport, setCommonSupport] = useState(0);
  const [additionalSupport, setAdditionalSupport] = useState(0);
  const [additionalEdited, setAdditionalEdited] = useState(false);
  const [contractType, setContractType] = useState('ê³µí†µì§€ì›');
  const [savedCommonSupport, setSavedCommonSupport] = useState(0);
  const [savedAdditionalSupport, setSavedAdditionalSupport] = useState(0);
  
  // ì„ íƒì•½ì • ì „ìš© ì¶”ê°€ì§€ì›ê¸ˆ(êµ¬ ì„ í• ì¸)
  const [selectiveAdditionalSupport, setSelectiveAdditionalSupport] = useState(0);

  // ë‹·ì»´/ê°¤ìº ìŠ¤ ìƒíƒœ ì¶”ê°€
  const [siteOption, setSiteOption] = useState('');

  // ----------------- ê²€ìƒ‰í˜• ìš”ê¸ˆì œ ë“œë¡­ë‹¤ìš´ ê´€ë ¨ State -----------------
  const [planSearchTerm, setPlanSearchTerm] = useState('');
  const [isPlanDropdownOpen, setIsPlanDropdownOpen] = useState(false);
  const planDropdownRef = useRef(null);

  // ì„ íƒëœ ìš”ê¸ˆì œê°€ ì™¸ë¶€(ì˜ˆ: í†µì‹ ì‚¬ ë³€ê²½)ì—ì„œ ë°”ë€Œë©´ ê²€ìƒ‰ì–´ ì…ë ¥ì°½ë„ ë™ê¸°í™”
  useEffect(() => { 
    setSelectedPlan(plans[0]?.name || ''); 
  }, [plans]);

  useEffect(() => {
    setPlanSearchTerm(selectedPlan);
  }, [selectedPlan]);

  // ìš”ê¸ˆì œ ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (planDropdownRef.current && !planDropdownRef.current.contains(event.target)) {
        setIsPlanDropdownOpen(false);
        setPlanSearchTerm(selectedPlan); // ì •ìƒì ìœ¼ë¡œ ì„ íƒëœ ìš”ê¸ˆì œ ì´ë¦„ìœ¼ë¡œ ë³µêµ¬
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, [selectedPlan]);

  // ê²€ìƒ‰ì–´ì— ë”°ë¥¸ ìš”ê¸ˆì œ í•„í„°ë§
  const filteredPlans = useMemo(() => {
    const term = planSearchTerm.trim().toLowerCase();
    // ì•„ë¬´ê²ƒë„ ì…ë ¥í•˜ì§€ ì•Šì•˜ê±°ë‚˜, í˜„ì¬ ì„ íƒëœ ìš”ê¸ˆì œ ì´ë¦„ê³¼ ì™„ì „íˆ ë™ì¼í•˜ë©´(ì¦‰ ì´ˆê¸° ìƒíƒœë©´) ì „ì²´ í‘œì‹œ
    if (!term || term === selectedPlan.toLowerCase()) return plans;
    return plans.filter(p => 
      p.name.toLowerCase().includes(term) || 
      p.price.toString().includes(term.replace(/,/g, '')) ||
      p.category.toLowerCase().includes(term)
    );
  }, [plans, planSearchTerm, selectedPlan]);
  // ----------------------------------------------------------------------


  // í†µì‹ ì‚¬ ë³€ê²½ ì‹œ ì²´í¬ë°•ìŠ¤ ë° ê¸ˆì•¡ ì´ˆê¸°í™”
  useEffect(() => {
    setSiteOption('');
    setAdditionalEdited(false);
    setSelectiveAdditionalSupport(0);
  }, [operator]);

  // KT / U+ íƒ­ ì„ íƒ ì‹œ ìš”ê¸ˆì œ ê°€ê²©ì— ë”°ë¥¸ ê³µí†µì§€ì›ê¸ˆ ìë™ ë§¤í•‘ (ì‚¬ì „ì˜ˆì•½ ë‹¨ë§ê¸° í•œì • + ê³µí†µì§€ì› ì•½ì •ì¼ ë•Œë§Œ)
  useEffect(() => {
    if (selectedDevice.includes('(ì‚¬ì „ì˜ˆì•½)') && contractType === 'ê³µí†µì§€ì›') {
      const planInfo = plans.find(p => p.name === selectedPlan);
      if (planInfo) {
        if (operator === 'U' && U_COMMON_SUPPORT_MAP[planInfo.price] !== undefined) {
          setCommonSupport(U_COMMON_SUPPORT_MAP[planInfo.price]);
        } else if (operator === 'KT' && KT_COMMON_SUPPORT_MAP[planInfo.price] !== undefined) {
          setCommonSupport(KT_COMMON_SUPPORT_MAP[planInfo.price]);
        }
      }
    }
  }, [selectedPlan, operator, plans, selectedDevice, contractType]);

  const originalPlanPrice = useMemo(() => plans.find(p => p.name === selectedPlan)?.price || 0, [selectedPlan, plans]);

  // ë‹·ì»´/ê°¤ìº ìŠ¤ ì¶”ê°€ì§€ì›ê¸ˆ ì ìš© (ì–‘ìª½ ì¹´ë“œì— ë™ì‹œ ë°˜ì˜, KT/U+ ëª¨ë‘ ë™ì‘)
  useEffect(() => {
    let autoAddSupport = 0;

    if (siteOption !== '' && selectedDevice.includes('(ì‚¬ì „ì˜ˆì•½)')) {
      const planPrice = originalPlanPrice;
      
      if (operator === 'U') {
        // U+ ë¡œì§
        if (planPrice >= 61000 && planPrice < 95000) {
          if (siteOption === 'ë‹·ì»´') autoAddSupport = 30000;
          else if (siteOption === 'ê°¤ìº ìŠ¤') autoAddSupport = 50000;
        } else if (planPrice >= 95000) {
          if (selectedDevice === 'S26 í”ŒëŸ¬ìŠ¤ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)' || selectedDevice === 'S26ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)') {
            if (siteOption === 'ë‹·ì»´') autoAddSupport = 250000;
            else if (siteOption === 'ê°¤ìº ìŠ¤') autoAddSupport = 300000;
          } else if (selectedDevice === 'S26 ìš¸íŠ¸ë¼ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)') {
            if (siteOption === 'ë‹·ì»´') autoAddSupport = 350000;
            else if (siteOption === 'ê°¤ìº ìŠ¤') autoAddSupport = 400000;
          }
        }
      } else if (operator === 'KT') {
        // KT ë¡œì§ (9ë§Œì› ì´ìƒ)
        if (planPrice >= 90000) {
          if (selectedDevice === 'S26 í”ŒëŸ¬ìŠ¤ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)' || selectedDevice === 'S26ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)') {
            if (siteOption === 'ë‹·ì»´') autoAddSupport = 250000;
            else if (siteOption === 'ê°¤ìº ìŠ¤') autoAddSupport = 300000;
          } else if (selectedDevice === 'S26 ìš¸íŠ¸ë¼ï½œ256ê¸°ê°€ (ì‚¬ì „ì˜ˆì•½)') {
            if (siteOption === 'ë‹·ì»´') autoAddSupport = 350000;
            else if (siteOption === 'ê°¤ìº ìŠ¤') autoAddSupport = 400000;
          }
        }
      }
    }

    // ğŸ”¥ ì•½ì •(ê³µí†µ/ì„ íƒ) ìƒê´€ì—†ì´ ì–‘ìª½ ìƒíƒœ ëª¨ë‘ ì—…ë°ì´íŠ¸í•˜ì—¬ í•˜ë‹¨ ê²°ê³¼ì°½ ë‘ ê³³ì— ë™ì‹œ ë°˜ì˜ë˜ë„ë¡ ì²˜ë¦¬
    if (siteOption !== '') {
      setAdditionalSupport(autoAddSupport);
      setSelectiveAdditionalSupport(autoAddSupport);
      setAdditionalEdited(true); // ìˆ˜ë™ ì…ë ¥ì²˜ëŸ¼ ì²˜ë¦¬í•˜ì—¬ KT 15% ìë™í™” ë¡œì§ê³¼ ì¶©ëŒ ë°©ì§€
    }
  }, [siteOption, selectedDevice, originalPlanPrice, operator]);

  // KT ì¶”ê°€ì§€ì›ê¸ˆ 15% ìë™ ì„¸íŒ… (ë‹·ì»´/ê°¤ìº ìŠ¤ ë¯¸ì„ íƒ ì‹œì—ë§Œ ì‘ë™)
  useEffect(() => {
    if (operator === 'KT' && !additionalEdited && siteOption === '') {
      const calculatedSupport = Math.floor((commonSupport * 0.15) / 100) * 100;
      setAdditionalSupport(calculatedSupport);
      setSavedAdditionalSupport(calculatedSupport);
    }
    setSavedCommonSupport(commonSupport);
  }, [commonSupport, operator, additionalEdited, siteOption]);

  useEffect(() => {
    if (editingTabId !== null && titleInputRef.current) { titleInputRef.current.focus(); titleInputRef.current.select(); }
  }, [editingTabId]);

  // ì²´í¬ë°•ìŠ¤ í† ê¸€ í•¨ìˆ˜
  const handleSiteOptionToggle = (val) => {
    if (siteOption === val) {
      setSiteOption(''); // í•´ì œ
      // í•´ì œ ì‹œ ê¸ˆì•¡ ì´ˆê¸°í™”
      if (contractType === 'ê³µí†µì§€ì›') {
        setAdditionalSupport(0); // KTì˜ ê²½ìš° ì•„ë˜ ì¤„ì— ì˜í•´ 15%ë¡œ ë‹¤ì‹œ ìë™ ê³„ì‚°ë¨
      }
      setSelectiveAdditionalSupport(0);
      
      // KTì—ì„œ ì²´í¬ë°•ìŠ¤ë¥¼ í’€ë©´ ë‹¤ì‹œ 15% ë£°ì„ íƒ€ë„ë¡ í—ˆìš©
      if (operator === 'KT') {
        setAdditionalEdited(false);
      }
    } else {
      setSiteOption(val); // ì„ íƒ
    }
  };

  const devicePrice = useMemo(()=> DEVICE_LIST.find(d=>d.name===selectedDevice)?.price || 0, [selectedDevice]);
  const monthlyPlanDiscount = useMemo(() => Math.round(originalPlanPrice * 0.25), [originalPlanPrice]);
  const totalPlanDiscount = useMemo(() => monthlyPlanDiscount * 24, [monthlyPlanDiscount]);
  const featureText = useMemo(()=> features[normalizePlanKey(selectedPlan)] || '', [selectedPlan, features]);

  // ê³µí†µì§€ì› ê³„ì‚°
  const totalDiscount_Public = commonSupport + additionalSupport;
  const principal_Public = Math.max(0, devicePrice - totalDiscount_Public);
  const monthlyDevice_Public = installMonths === 0 ? 0 : Math.round(pmt(interestRate/12, installMonths, principal_Public));
  const totalMonthly_Public = monthlyDevice_Public + originalPlanPrice;
  const totalInterest_Public = installMonths === 0 ? 0 : Math.max(0, (monthlyDevice_Public * installMonths) - principal_Public);

  // ì„ íƒì•½ì • ê³„ì‚°
  const totalDiscount_Selective = selectiveAdditionalSupport + totalPlanDiscount;
  const principal_Selective = Math.max(0, devicePrice - selectiveAdditionalSupport);
  const monthlyDevice_Selective = installMonths === 0 ? 0 : Math.round(pmt(interestRate/12, installMonths, principal_Selective));
  const planPrice_Selective = Math.round(originalPlanPrice * 0.75);
  const totalMonthly_Selective = monthlyDevice_Selective + planPrice_Selective;
  const totalInterest_Selective = installMonths === 0 ? 0 : Math.max(0, (monthlyDevice_Selective * installMonths) - principal_Selective);

  const highlightClassPublic = totalMonthly_Public < totalMonthly_Selective ? 'bg-green-50 ring-2 ring-green-500 z-10' : 'bg-white';
  const highlightClassSelective = totalMonthly_Selective < totalMonthly_Public ? 'bg-green-50 ring-2 ring-green-500 z-10' : 'bg-white';

  const activeMemo = memos.find(memo => memo.id === activeMemoId);
  const consultationStatuses = ['ìƒë‹´ì™„ë£Œ', 'ìƒë‹´ë¶€ì¬', 'ì„œì‹ì§€ ì‘ì„±ì•ˆë‚´ì™„ë£Œ', 'ì„œì‹ì§€ ë¯¸ì ‘ìˆ˜(ë¶€ì¬)', 'ë³´ë¥˜'];

  const handleContractTypeChange = (newType) => setContractType(newType);

  return (
    <div className="p-4 max-w-4xl mx-auto">
      <div className="mb-4 flex flex-wrap gap-4">
        
        <select value={selectedDevice} onChange={e=>setSelectedDevice(e.target.value)} className="border p-2 rounded w-[calc(40%+2rem)] outline-none focus:ring-2 focus:ring-blue-500">
          {CATEGORIZED_DEVICE_LIST.map(group => (
            <optgroup key={group.category} label={group.category}>
              {group.devices.map(d => (
                <option key={d.name} value={d.name} className={d.isHighlight ? "font-bold text-red-600" : ""} style={d.isHighlight ? { fontWeight: 'bold', color: 'red' } : {}}>{d.name} ({d.price.toLocaleString()}ì›)</option>
              ))}
            </optgroup>
          ))}
        </select>
        
        {/* --- ë³€ê²½ëœ ìš”ê¸ˆì œ ê²€ìƒ‰ ë“œë¡­ë‹¤ìš´ UI --- */}
        <div className="relative flex-1 min-w-0" ref={planDropdownRef}>
          <input 
            type="text" 
            value={planSearchTerm} 
            onChange={(e) => { setPlanSearchTerm(e.target.value); setIsPlanDropdownOpen(true); }}
            onClick={(e) => { setIsPlanDropdownOpen(true); e.target.select(); }}
            placeholder="ìš”ê¸ˆì œ ì´ë¦„ ë˜ëŠ” ê°€ê²© ê²€ìƒ‰..."
            className="border p-2 rounded w-full outline-none focus:ring-2 focus:ring-blue-500"
          />
          {isPlanDropdownOpen && (
            <div className="absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded shadow-lg max-h-60 overflow-y-auto">
              {filteredPlans.length > 0 ? (
                filteredPlans.map(p => (
                  <div 
                    key={p.name} 
                    onClick={() => { setSelectedPlan(p.name); setPlanSearchTerm(p.name); setIsPlanDropdownOpen(false); }}
                    className={`px-3 py-2 cursor-pointer hover:bg-blue-50 text-sm border-b last:border-b-0 ${selectedPlan === p.name ? 'bg-blue-100 font-bold' : ''}`}
                  >
                    <span className="text-gray-500 text-xs mr-1">[{p.category}]</span> 
                    {p.name} <span className="text-gray-700 ml-1">({p.price.toLocaleString()}ì›)</span>
                  </div>
                ))
              ) : (
                <div className="px-3 py-2 text-sm text-gray-500 text-center">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
              )}
            </div>
          )}
        </div>
        {/* ------------------------------------- */}

        <select value={installMonths} onChange={e=>setInstallMonths(Number(e.target.value))} className="border p-2 rounded w-24 text-center outline-none focus:ring-2 focus:ring-blue-500">
          {[0,6,12,18,24,30,36,48].map(m=><option key={m} value={m}>{m===0?'ì¼ì‹œë¶ˆ':m+'ê°œì›”'}</option>)}
        </select>
      </div>

      <div className="mb-4 flex flex-nowrap items-end gap-3 w-full overflow-x-auto pb-2 hide-scroll-bar">
        
        <div className="flex flex-col shrink-0">
          <label className="text-sm text-center">ê³µí†µì§€ì›ê¸ˆ</label>
          <input type="text" value={commonSupport.toLocaleString()} disabled={contractType === 'ì„ íƒì•½ì •'} onChange={e => { setCommonSupport(Number(e.target.value.replace(/\D/g, '')) || 0); setAdditionalEdited(false); }} className={`border p-1 rounded w-28 text-center ${contractType === 'ì„ íƒì•½ì •' ? 'bg-gray-200 text-gray-400' : 'bg-white'}`} onFocus={e=>e.target.select()} />
        </div>
        
        <div className="flex flex-col shrink-0">
          <label className="text-sm text-center">ì¶”ê°€ì§€ì›ê¸ˆ</label>
          <input type="text" value={(contractType === 'ê³µí†µì§€ì›' ? additionalSupport : selectiveAdditionalSupport).toLocaleString()} onChange={e => { const v = Number(e.target.value.replace(/\D/g, '')) || 0; if (contractType === 'ê³µí†µì§€ì›') { setAdditionalSupport(v); setAdditionalEdited(true); } else { setSelectiveAdditionalSupport(v); } }} className="border p-1 rounded w-28 text-center bg-white" onFocus={e=>e.target.select()} />
        </div>

        <div className="flex flex-col shrink-0">
          <label className="text-sm mb-1 text-center">ì•½ì •</label>
          <div className="flex border rounded overflow-hidden h-[34px]">
            <button onClick={()=>handleContractTypeChange('ê³µí†µì§€ì›')} className={`px-3 text-sm transition-colors whitespace-nowrap ${contractType==='ê³µí†µì§€ì›'?'bg-blue-600 text-white':'bg-white text-gray-700 hover:bg-gray-100'}`}>ê³µí†µì§€ì›</button>
            <div className="border-l"></div>
            <button onClick={()=>handleContractTypeChange('ì„ íƒì•½ì •')} className={`px-3 text-sm transition-colors whitespace-nowrap ${contractType==='ì„ íƒì•½ì •'?'bg-blue-600 text-white':'bg-white text-gray-700 hover:bg-gray-100'}`}>ì„ íƒì•½ì •</button>
          </div>
        </div>
        
        <div className="flex flex-col shrink-0">
           <label className="text-sm mb-1 text-center">&nbsp;</label>
           <div className="flex gap-2 items-center h-[34px]">
            
            <label className="flex items-center text-sm cursor-pointer text-gray-700 whitespace-nowrap font-medium mr-1">
              <input type="checkbox" checked={siteOption === 'ë‹·ì»´'} onChange={() => handleSiteOptionToggle('ë‹·ì»´')} className="mr-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500" />
              ë‹·ì»´
            </label>
            <label className="flex items-center text-sm cursor-pointer text-gray-700 whitespace-nowrap font-medium mr-2">
              <input type="checkbox" checked={siteOption === 'ê°¤ìº ìŠ¤'} onChange={() => handleSiteOptionToggle('ê°¤ìº ìŠ¤')} className="mr-1 w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500" />
              ê°¤ìº ìŠ¤
            </label>

            <button onClick={() => setShowPlanSummaryPopup(true)} className="bg-blue-500 text-white px-3 rounded hover:bg-blue-600 h-[34px] flex items-center justify-center text-sm whitespace-nowrap">ìš”ê¸ˆì œ ì •ë¦¬</button>
            <button onClick={() => setShowRequestFormPopup(true)} className="bg-purple-600 text-white px-3 rounded hover:bg-purple-700 h-[34px] flex items-center justify-center text-sm whitespace-nowrap">ìš”ì²­ ì–‘ì‹</button>
            <button onClick={() => setShowDeviceColorPopup(true)} className="bg-pink-600 text-white px-3 rounded hover:bg-pink-700 h-[34px] flex items-center justify-center text-sm whitespace-nowrap">ë‹¨ë§ê¸° ìƒ‰ìƒ</button>
           </div>
        </div>
      </div>

      <div className="mt-4"><div className="p-4 rounded-t bg-white shadow-md border-b border-gray-200"><div className="text-black font-bold text-xl">ë‹¨ë§ê¸° ì¶œê³ ê°€: {devicePrice.toLocaleString()}ì›</div><div className="text-gray-700 text-lg">ê¸°ë³¸ í†µì‹ ìš”ê¸ˆ: {originalPlanPrice.toLocaleString()}ì› {featureText && <span className="text-gray-600 text-sm ml-2">({featureText})</span>}</div></div>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-px bg-gray-200 rounded-b shadow-md overflow-hidden">
          <div className={`p-4 flex flex-col gap-1.5 transition-all ${highlightClassPublic}`}><h3 className="text-xl font-bold text-center text-blue-700 mb-2">ê³µí†µì§€ì›</h3><div className="text-red-600 font-bold text-lg">ì´ í• ì¸ì•¡ : <span>-{totalDiscount_Public.toLocaleString()}ì›</span></div><div className="text-green-600 font-bold text-lg">ë‹¨ë§ê¸° í• ë¶€ì›ê¸ˆ: {principal_Public.toLocaleString()}ì› {installMonths > 0 && principal_Public > 0 && <span className="text-sm font-normal ml-2 text-gray-600">(ì´ ì´ì: {totalInterest_Public.toLocaleString()}ì›)</span>}</div><div className="text-blue-600 font-bold text-lg">ì›” í• ë¶€ê¸ˆ: {monthlyDevice_Public.toLocaleString()}ì›</div><div className="text-blue-600 font-bold text-lg">ì›” í†µì‹ ìš”ê¸ˆ: {originalPlanPrice.toLocaleString()}ì›</div><div className="text-black font-bold text-2xl mt-2 pt-2 border-t border-gray-300">ì›” ë‚©ë¶€ ì˜ˆìƒê¸ˆì•¡: <span className="ml-2">{totalMonthly_Public.toLocaleString()}ì›</span></div></div>
          <div className={`p-4 flex flex-col gap-1.5 transition-all ${highlightClassSelective}`}><h3 className="text-xl font-bold text-center text-blue-700 mb-2">ì„ íƒì•½ì • (25% ìš”ê¸ˆí• ì¸)</h3><div className="text-red-600 font-bold text-lg">ì´ í• ì¸ì•¡ : <span>-{totalDiscount_Selective.toLocaleString()}ì› <span className="block text-sm font-normal text-gray-600">(ê¸°ê¸°í• ì¸ {selectiveAdditionalSupport.toLocaleString()}ì› + ìš”ê¸ˆí• ì¸ {totalPlanDiscount.toLocaleString()}ì›)</span></span></div><div className="text-green-600 font-bold text-lg">ë‹¨ë§ê¸° í• ë¶€ì›ê¸ˆ: {principal_Selective.toLocaleString()}ì› {installMonths > 0 && principal_Selective > 0 && <span className="text-sm font-normal ml-2 text-gray-600">(ì´ ì´ì: {totalInterest_Selective.toLocaleString()}ì›)</span>}</div><div className="text-blue-600 font-bold text-lg">ì›” í• ë¶€ê¸ˆ: {monthlyDevice_Selective.toLocaleString()}ì›</div><div className="text-blue-600 font-bold text-lg">ì›” í†µì‹ ìš”ê¸ˆ: {planPrice_Selective.toLocaleString()}ì› <span className="text-sm font-normal ml-2 text-gray-600">({monthlyPlanDiscount.toLocaleString()}ì› í• ì¸)</span></div><div className="text-black font-bold text-2xl mt-2 pt-2 border-t border-gray-300">ì›” ë‚©ë¶€ ì˜ˆìƒê¸ˆì•¡: <span className="ml-2">{totalMonthly_Selective.toLocaleString()}ì›</span></div></div>
        </div>
      </div>

      <div className="mt-6">
        <div className="flex items-center border-b border-gray-200">{memos.map(memo => (
          <div key={memo.id} className="relative group"><button onClick={() => setActiveMemoId(memo.id)} onDoubleClick={() => handleStartEditing(memo)} className={`px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors duration-200 ease-in-out ${activeMemoId === memo.id ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>{editingTabId === memo.id ? <input ref={titleInputRef} type="text" value={tempTitle} onChange={handleTitleChange} onBlur={() => handleSaveTitle(memo.id)} onKeyDown={(e) => handleKeyDown(e, memo.id)} className="p-0 m-0 border-0 focus:ring-0 bg-transparent text-center" style={{ width: `${Math.max(3, tempTitle.length) + 1}ch` }} /> : <span>{memo.title}</span>}</button>{memos.length > 1 && <button onClick={() => handleDeleteMemo(memo.id)} className="absolute top-0 right-0 p-1 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">Ã—</button>}</div>))}<button onClick={handleAddMemo} className="ml-2 px-3 py-1 text-sm text-gray-500 hover:text-blue-600 hover:bg-gray-100 rounded-full">+</button></div>
        <textarea value={activeMemo?.content || ''} onChange={handleMemoChange} rows="6" className="p-2 border border-gray-300 rounded-b shadow-sm w-full focus:ring-blue-500 focus:border-blue-500 mt-[-1px]" placeholder={`[ì‚¬ìš©ë°©ë²•]\n1. "+" ë²„íŠ¼ì„ ëˆŒëŸ¬ ë©”ëª¨ íƒ­ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n2. ê° íƒ­ì˜ ì œëª©ì„ ë”ë¸”í´ë¦­í•˜ì—¬ ê¸€ì ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. (í•œê¸€ê¸°ì¤€ ìµœëŒ€ 8ê¸€ì)\n3. í•˜ë‹¨ì— ìˆëŠ” ìƒíƒœê°’ì„ í´ë¦­í•˜ì—¬ í˜„í™© ì²´í¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n   (í™œì„±í™”/ë¹„í™œì„±í™” ë° íƒ­ ë§ˆë‹¤ ê°œë³„ ì§€ì • ê°€ëŠ¥)\n4. ìƒë‹¨ì— 'ë©”ëª¨ ì €ì¥' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë©”ëª¨ íƒ­ ì „ì²´ê°€ ì €ì¥ë©ë‹ˆë‹¤.`} spellCheck="false"></textarea>
      </div>
      <div className="mt-4 p-4 border rounded bg-white shadow-sm"><div className="text-sm font-medium text-gray-700 mb-3">ìƒë‹´ í˜„í™©</div><div className="flex flex-wrap gap-x-4 gap-y-2">{consultationStatuses.map(status => (<button key={status} onClick={() => handleStatusChange(status)} className={`px-3 py-1 text-xs rounded-full cursor-pointer transition-colors ${activeMemo?.status === status ? 'bg-blue-600 text-white font-semibold' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>{status}</button>))}</div></div>
    </div>
  );
}

function App() {
  const [operator, setOperator] = useState('KT');
  const [trackingNumber, setTrackingNumber] = useState('');
  const [showPopup, setShowPopup] = useState(false);
  const [showRequestFormPopup, setShowRequestFormPopup] = useState(false);
  const [showDeviceColorPopup, setShowDeviceColorPopup] = useState(false);
  const [showPlanSummaryPopup, setShowPlanSummaryPopup] = useState(false);
  const [memos, setMemos] = useState([{ id: 1, title: 'ë©”ëª¨ 1', content: '', status: null }]);
  const [activeMemoId, setActiveMemoId] = useState(1);
  const [editingTabId, setEditingTabId] = useState(null);
  const [tempTitle, setTempTitle] = useState('');
  const titleInputRef = useRef(null);

  const handleAddMemo = () => { const newId = (memos.length > 0 ? Math.max(...memos.map(m => m.id)) : 0) + 1; setMemos([...memos, { id: newId, title: `ë©”ëª¨ ${newId}`, content: '', status: null }]); setActiveMemoId(newId); };
  const handleMemoChange = (e) => setMemos(memos.map(m => m.id === activeMemoId ? { ...m, content: e.target.value } : m));
  const handleStartEditing = (m) => { setEditingTabId(m.id); setTempTitle(m.title); };
  const handleTitleChange = (e) => { if (e.target.value.length <= 8) setTempTitle(e.target.value); };
  const handleSaveTitle = (id) => { if(tempTitle.trim()) setMemos(memos.map(m => m.id === id ? { ...m, title: tempTitle } : m)); setEditingTabId(null); };
  const handleKeyDown = (e, id) => { if (e.key === 'Enter') handleSaveTitle(id); else if (e.key === 'Escape') setEditingTabId(null); };
  const handleDeleteMemo = (id) => { if(memos.length <= 1) { alert("ë§ˆì§€ë§‰ ë©”ëª¨ íƒ­ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; } const n = memos.filter(m => m.id !== id); setMemos(n); if(activeMemoId === id) setActiveMemoId(n[0].id); };
  const handleStatusChange = (s) => setMemos(memos.map(m => m.id === activeMemoId ? { ...m, status: m.status === s ? null : s } : m));
  const handleSaveMemosToFile = () => { if (!memos.some(m => m.content.trim() || m.status)) return alert('ì €ì¥í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.'); const c = memos.map(m => `[${m.title}]\n${m.content}${m.status ? `\n\nìƒë‹´ í˜„í™©: ${m.status}` : ''}`).join('\n\n' + '='.repeat(20) + '\n\n'); const b = new Blob([c], { type: 'text/plain;charset=utf-8' }); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'ë©”ëª¨.txt'; a.click(); };
  const handleTrackingSearch = () => { if (!trackingNumber || !/^\d+$/.test(trackingNumber)) return alert('ìˆ«ìë¡œ ëœ ì†¡ì¥ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); window.open(`https://trace.cjlogistics.com/next/tracking.html?wblNo=${trackingNumber}`, 'cjTrackingPopup', 'width=1600,height=900,scrollbars=yes,resizable=yes'); setTrackingNumber(''); };

  const plans = useMemo(()=> operator==='KT'?PLAN_LIST_KT:PLAN_LIST_U, [operator]);
  const features = useMemo(()=> operator==='KT'?PLAN_FEATURES_KT:PLAN_FEATURES_U, [operator]);

  return (
    <div>
      <div className="p-4 max-w-4xl mx-auto flex flex-wrap gap-4 items-center">
        <button className={`px-4 py-2 rounded text-sm font-bold ${operator === 'KT' ? 'bg-blue-600 text-white shadow' : 'bg-white border'}`} onClick={() => setOperator('KT')}>KT</button>
        <button className={`px-4 py-2 rounded text-sm font-bold ${operator === 'U' ? 'bg-green-600 text-white shadow' : 'bg-white border'}`} onClick={() => setOperator('U')}>U+</button>
        {operator === 'KT' && <a href="https://shop.kt.com/mobile/products.do?&=&category=mobile" target="_blank" className="ml-4 bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600 text-sm">KTë‹·ì»´</a>}
        {operator === 'U' && <a href="https://www.lguplus.com/mobile/device/phone" target="_blank" className="ml-4 bg-green-500 text-white px-3 py-2 rounded hover:bg-green-600 text-sm">U+ë‹·ì»´</a>}
        <div className="flex items-center ml-4"><a href="https://www.samsung.com/sec/smartphones/all-smartphones/?carrier-phone" target="_blank" className="bg-gray-800 text-white px-3 py-2 rounded hover:bg-gray-900 text-sm">ì‚¼ì„±ë‹·ì»´</a></div>
        <div className="flex items-center ml-2 gap-2">
          <button onClick={handleSaveMemosToFile} className="bg-emerald-600 text-white px-3 py-2 rounded hover:bg-emerald-700 text-sm">ë©”ëª¨ ì €ì¥</button>
          <button onClick={() => setShowPopup(true)} className="bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700 text-sm">ê³ ê°ì„¼í„°</button>
        </div>
        <div className="flex items-center ml-auto gap-2">
          <input type="text" value={trackingNumber} onChange={(e) => setTrackingNumber(e.target.value.replace(/\D/g, ''))} onKeyDown={(e) => e.key === 'Enter' && handleTrackingSearch()} placeholder="CJëŒ€í•œí†µìš´ ì†¡ì¥ë²ˆí˜¸" className="border p-2 rounded w-48 h-[40px]" />
          <button onClick={handleTrackingSearch} className="bg-amber-500 text-white px-3 py-2 rounded hover:bg-amber-600 h-[40px] text-sm">ë°°ì†¡ì¡°íšŒ</button>
        </div>
      </div>
      <Calculator plans={plans} features={features} operator={operator} memos={memos} activeMemoId={activeMemoId} setActiveMemoId={setActiveMemoId} editingTabId={editingTabId} setEditingTabId={setEditingTabId} tempTitle={tempTitle} setTempTitle={setTempTitle} titleInputRef={titleInputRef} handleMemoChange={handleMemoChange} handleStartEditing={handleStartEditing} handleTitleChange={handleTitleChange} handleSaveTitle={handleSaveTitle} handleKeyDown={handleKeyDown} handleDeleteMemo={handleDeleteMemo} handleAddMemo={handleAddMemo} handleStatusChange={handleStatusChange} setShowRequestFormPopup={setShowRequestFormPopup} setShowDeviceColorPopup={setShowDeviceColorPopup} setShowPlanSummaryPopup={setShowPlanSummaryPopup} />
      {showPopup && <CustomerServicePopup onClose={() => setShowPopup(false)} />}
      {showRequestFormPopup && <RequestFormPopup onClose={() => setShowRequestFormPopup(false)} />}
      {showDeviceColorPopup && <DeviceColorPopup onClose={() => setShowDeviceColorPopup(false)} />}
      {showPlanSummaryPopup && <PlanSummaryPopup operator={operator} onClose={() => setShowPlanSummaryPopup(false)} />}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
