<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>통신사폰 계산기</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-50">
<div id="root"></div>

<script type="text/babel">
const { useState, useMemo, useEffect } = React;

// 월 할부 계산 함수
function pmt(rate, nper, pv) {
  if(rate===0) return pv/nper;
  return (rate*pv)/(1-Math.pow(1+rate, -nper));
}

// ------------------ 단말기 ------------------
const DEVICE_LIST = [
  { name: '폴드7 ｜ 256기가', price: 2379300 },
  { name: '폴드7 ｜ 512기가', price: 2537700 },
  { name: 'separator-1', isSeparator: true },
  { name: '플립7 FE ｜ 256기가', price: 1199000 },
  { name: '플립7 ｜ 256기가', price: 1485000 },
  { name: '플립7 ｜ 512기가', price: 1643400 },
  { name: 'separator-2', isSeparator: true },
  { name: 'S25엣지 ｜ 256기가', price: 1496000 },
  { name: 'S25엣지 ｜ 512기가', price: 1639000 },
  { name: 'S25울트라 ｜ 256기가', price: 1698400 },
  { name: 'S25플러스 ｜ 256기가', price: 1353000 },
  { name: 'S25 ｜ 256기가', price: 1155000 },
  { name: 'S24 FE ｜ 256기가', price: 946000 },
  { name: 'separator-3', isSeparator: true },
  { name: 'A36 5G ｜ 128기가', price: 499400 },
  { name: 'A16 LTE ｜ 128기가', price: 319000 }
];

// 단말기 목록을 카테고리별로 분류하고 가격순으로 정렬합니다.
const CATEGORIZED_DEVICE_LIST = (() => {
  const devices = DEVICE_LIST.filter(d => !d.isSeparator);
  const categories = {
    '폴더블': [],
    'S 시리즈': [],
    'A 시리즈': []
  };

  devices.forEach(device => {
    if (device.name.includes('폴드') || device.name.includes('플립')) {
      categories['폴더블'].push(device);
    } else if (device.name.includes('S')) {
      categories['S 시리즈'].push(device);
    } else if (device.name.includes('A')) {
      categories['A 시리즈'].push(device);
    }
  });

  for (const key in categories) {
    categories[key].sort((a, b) => b.price - a.price);
  }

  return Object.keys(categories).map(key => ({
    category: key,
    devices: categories[key]
  }));
})();

// ------------------ KT 요금제 ------------------
const PLAN_LIST_KT = [
  { category: 'LTE', name: 'LTE 데이터선택 32.8(신규가입 중단)', price: 32890 },
  { category: 'LTE', name: 'LTE 베이직', price: 33000 },
  { category: 'LTE', name: 'LTE 데이터선택 38.3(신규가입 중단)', price: 38390 },
  { category: 'LTE', name: 'LTE 안심데이터 38.5(신규가입 중단)', price: 38500 },
  { category: 'LTE', name: 'LTE 데이터선택 43,8(신규가입 중단)', price: 43890 },
  { category: 'LTE', name: 'LTE 베이직 플러스(신규가입 중단)', price: 44000 },
  { category: 'LTE', name: '데이터ON 톡(신규가입 중단)', price: 49000 },
  { category: 'LTE', name: '데이터ON 톡 플러스(신규가입 중단)', price: 49000 },
  { category: 'LTE', name: 'LTE 데이터선택 49.3(신규가입 중단)', price: 49490 },
  { category: 'LTE', name: 'LTE 데이터선택 54.8(신규가입 중단)', price: 54890 },
  { category: 'LTE', name: 'LTE 슬림 플러스(신규가입 중단)', price: 61000 },
  { category: 'LTE', name: 'LTE 데이터선택 65.8(신규가입 중단)', price: 65890 },
  { category: 'LTE', name: '데이터ON 비디오 (신규가입 중단)', price: 69000 },
  { category: 'LTE', name: '데이터ON 비디오 플러스', price: 69000 },
  { category: 'LTE', name: 'LTE 데이터선택 76.8(신규가입 중단)', price: 76890 },
  { category: 'LTE', name: '데이터ON 프리미엄', price: 89000 },
  { category: 'LTE', name: 'LTE 데이터선택 87.8(신규가입 중단)', price: 87890 },
  { category: 'LTE', name: 'LTE 데이터선택 87.8(로밍)(신규가입 중단)', price: 87890 },
  { category: 'LTE', name: 'LTE 데이터선택 109(신규가입 중단)', price: 109890 },
  { category: '시니어', name: '시니어 베이직(LTE)', price: 33000 },
  { category: '시니어', name: '5G 시니어 C형', price: 41000 },
  { category: '시니어', name: '5G 시니어 B형', price: 42000 },
  { category: '시니어', name: '5G 시니어 A형', price: 44000 },
  { category: '시니어', name: '5G 시니어 베이직', price: 49000 },
  { category: 'Y', name: 'LTE Y베이직', price: 33000 },
  { category: 'Y', name: 'Y군인 33', price: 33000 },
  { category: 'Y', name: '5G Y틴', price: 47000 },
  { category: 'Y', name: 'Y데이터ON 톡(신규가입 중단)', price: 49000 },
  { category: 'Y', name: 'Y데이터ON 톡 플러스(신규가입 중단)', price: 49000 },
  { category: 'Y', name: '5G Y슬림', price: 55000 },
  { category: 'Y', name: 'Y군인 55 Plus', price: 55000 },
  { category: 'Y', name: 'Y군인 55 Plus 미디어팩', price: 55000 },
  { category: 'Y', name: 'Y데이터ON 비디오(신규가입 중단)', price: 69000 },
  { category: 'Y', name: 'Y데이터ON 비디오 플러스', price: 69000 },
  { category: 'Y', name: 'Y군인 77 Plus', price: 77000 },
  { category: 'Y', name: '5G Y베이직', price: 80000 },
  { category: 'Y', name: 'Y데이터ON 프리미엄', price: 89000 },
  { category: 'Y', name: '5G Y스페셜', price: 100000 },
  { category: '5G', name: '5G 슬림 4GB', price: 37000 },
  { category: '5G', name: '5G 슬림 7GB', price: 45000 },
  { category: '5G', name: '5G 슬림 10GB', price: 50000 },
  { category: '5G', name: '5G 슬림 14GB', price: 55000 },
  { category: '5G', name: '5G 슬림 21GB', price: 58000 },
  { category: '5G', name: '5G 심플 30GB', price: 61000 },
  { category: '5G', name: '5G 심플 50GB', price: 63000 },
  { category: '5G', name: '5G 심플 70GB', price: 65000 },
  { category: '5G', name: '5G 심플 90GB', price: 67000 },
  { category: '5G', name: '5G 심플 110GB', price: 69000 },
  { category: '5G', name: '5G 베이직', price: 80000 },
  { category: '5G', name: '5G 초이스 베이직', price: 90000 },
  { category: '5G', name: '5G 스페셜', price: 100000 },
  { category: '5G', name: '5G 초이스 스페셜', price: 110000 },
  { category: '5G', name: '5G 초이스 프리미엄', price: 130000 },
];

// KT 요금제 특징
const PLAN_FEATURES_KT = {
  'LTE 베이직':'1.4GB + Qos', '데이터ON 톡 플러스':'5GB + 1Mbps', '데이터ON 비디오':'100GB + 5Mbps/VIP', 'LTE 슬림 플러스':'30GB + 1Mbps', 'LTE 베이직 플러스':'3GB + 400Kbps', 'LTE 안심데이터 38.5':'450MB + 400Kbps', '데이터ON 비디오 플러스':'110GB + 5Mbps/2022년 12월 이전까지 VIP', '데이터ON 프리미엄':'완전 무제한/스마트기기 1회선 무료VIP/필수팩 L3(지니/밀리) 무료/단말보험 멤버십 포인트 최대 4,500P 차감', '5G 시니어 베이직':'15GB + 1Mbps/만 65세 이상', '5G 시니어 A형':'10GB + 1Mbps/만 65세 이상', '5G 시니어 B형':'9GB + 1Mbps/만 75세 이상', '5G 시니어 C형':'8GB + 1Mbps/만 80세 이상', 'LTE Y베이직':'2.5GB + Qos', '5G Y틴':'10GB + 1Mbps', 'Y데이터ON 톡 플러스':'6GB + 1Mbps/미디어팩 50%할인', '5G Y슬림':'14GB + 1Mbps/로밍 데이터 속도 100Kbps', 'Y데이터ON 비디오 플러스':'110GB + 5Mbps/필수팩 L3(지니/밀리) 50%할인/2022년 12월 이전까지 VIP', '5G Y베이직':'완전 무제한/스마트기기 1회선 50% 할인(Y덤)/로밍 데이터 속도 1Mbps/VIP', 'Y데이터ON 프리미엄':'완전 무제한/스마트기기 1회선 무료/VIP/필수팩 L3(지니/밀리) 무료/단말보험 멤버십 포인트 최대 4,500P 차감', '5G Y스페셜':'완전 무제한/스마트기기 1회선 무료/로밍 데이터 속도 1Mbps/VVIP/단말보험 멤버십 포인트 최대 4,500P 차감', '5G 슬림 4GB':'400Kbps', '5G 슬림 7GB':'400Kbps', '5G 슬림 10GB':'400Kbps', '5G 슬림 14GB':'1Mbps', '5G 슬림 21GB':'1Mbps', '5G 심플 30GB':'1Mbps', '5G 심플 50GB':'1Mbps', '5G 심플 70GB':'1Mbps', '5G 심플 90GB':'1Mbps', '5G 심플 110GB':'5Mbps', '5G 베이직':'완전 무제한/만 34세 이하 스마트기기 1회선 50% 할인(Y덤)/로밍 데이터 속도 100Kbps/VIP', '5G 스페셜':'완전 무제한/스마트기기 1회선 무료/로밍 데이터 속도 100Kbps/VVIP/단말보험 멤버십 포인트 최대 4,500P 차감', '5G 초이스 베이직':'유튜브 선택시 월 4,450원 추가', '5G 초이스 스페셜':'유튜브 선택시 월 4,450원 추가', '5G 초이스 프리미엄':'유튜브 선택시 월 4,450원 추가',
  'Y군인 77 Plus': '무제한/VIP/초이스(택2)',
  'Y군인 55 Plus 미디어팩': '100GB + 5Mbps/24.07.03까지:미디어팩, 24.07.04부터 필수팩 L3',
  'Y군인 55 Plus': '100GB + 5Mbps/초이스(택1)',
  'Y군인 33': '일 2GB + 3Mbps/24.07.03까지:미디어팩, 24.07.04부터 필수팩 L3',
  'LTE 데이터선택 32.8': '300MB + 밀당',
  'LTE 데이터선택 38.3': '1GB + 밀당',
  'LTE 데이터선택 43,8': '2GB + 밀당',
  'LTE 데이터선택 49.3': '3GB + 밀당',
  'LTE 데이터선택 54.8': '6GB + 밀당/시즌플레인(24개월 무료)',
  'LTE 데이터선택 65.8': '10GB + 일 2GB + 3Mbps/시즌플레인(24개월 무료)',
  'LTE 데이터선택 76.8': '15GB + 일 2GB + 3Mbps/VIP/스마트기기 요금할인 50%할인 or 5,500원 할인/시즌플레인(24개월 무료)',
  'LTE 데이터선택 87.8(로밍)': '20GB + 일 2GB + 3Mbps/VIP/스마트기기 요금할인 무료 or 11,000원 할인/미디어팩 무료 or 리얼 미디어팩 50%할인(적용일:19.08.13)/하루종일 로밍 2일(이용권 2매)',
  'LTE 데이터선택 87.8': '20GB + 일 2GB + 3Mbps/VIP/스마트기기 요금할인 무료 or 11,000원 할인/미디어팩 무료 or 리얼 미디어팩 50%할인(적용일:19.08.13)',
  'LTE 데이터선택 109': '30GB + 일 2GB + 5Mbps/VIP/단말보험(멤버십 할인)/스마트기기 요금할인 무료 or 11,000원 할인/미디어팩 무료 or 리얼 미디어팩 50%할인(적용일:19.08.13)/하루종일 로밍 5일(이용권 5매)',
  '데이터ON 톡': '3GB + 1Mbps',
  'Y데이터ON 톡': '6GB + 1Mbps/필수팩 L3(미디어팩) 50%할인',
  'Y데이터ON 비디오': '100GB + 5Mbps/VIP/필수팩 L3(미디어팩) 50%할인',
  '시니어 베이직': '2GB + 밀당'
};

// ------------------ U+ 요금제 ------------------
const PLAN_LIST_U = [
  { category: 'LTE', name: '데이터 일반(신규가입 중단)', price: 32890 }, { category: 'LTE', name: '데이터 1.3(신규가입 중단)', price: 39490 }, { category: 'LTE', name: '데이터 2.3(신규가입 중단)', price: 46090 }, { category: 'LTE', name: '데이터 3.6(신규가입 중단)', price: 51590 }, { category: 'LTE', name: '데이터 6.6(신규가입 중단)', price: 55990 }, { category: 'LTE', name: '스페셜 A(신규가입 중단)', price: 65890 }, { category: 'LTE', name: '스페셜 B(신규가입 중단)', price: 74800 }, { category: 'LTE', name: 'LTE 데이터33', price: 33000 }, { category: 'LTE', name: 'LTE 추걱데44(신규가입 중단)', price: 44000 }, { category: 'LTE', name: 'LTE 추걱데49(신규가입 중단)', price: 49000 }, { category: 'LTE', name: 'LTE 추걱데59(신규가입 중단)', price: 59000 }, { category: 'LTE', name: 'LTE 추걱데69(신규가입 중단)', price: 69000 }, { category: 'LTE', name: 'LTE 속걱데78(신규가입 중단)', price: 78000 }, { category: 'LTE', name: 'LTE 속걱데88(신규가입 중단)', price: 88000 }, { category: 'LTE', name: 'LTE 프리미어 에센셜(신규가입 중단)', price: 85000 }, { category: 'LTE', name: 'LTE 프리미어 플러스(신규가입 중단)', price: 105000 },
  { category: '시니어', name: '5G 시니어 A형', price: 45000 },
  { category: '시니어', name: '5G 시니어 B형', price: 43000 },
  { category: '시니어', name: '5G 시니어 C형', price: 39000 },
  { category: '5G', name: '5G 미니', price: 37000 }, { category: '5G', name: '5G 슬림+', price: 47000 }, { category: '5G', name: '5G 라이트+', price: 55000 }, { category: '5G', name: '5G 베이직+', price: 59000 }, { category: '5G', name: '5G 심플+', price: 61000 }, { category: '5G', name: '5G 데이터 레귤러', price: 63000 }, { category: '5G', name: '5G 데이터 플러스', price: 66000 }, { category: '5G', name: '5G 데이터 슈퍼', price: 68000 }, { category: '5G', name: '5G 스탠다드 에센셜', price: 70000 }, { category: '5G', name: '5G 스탠다드', price: 75000 }, { category: '5G', name: '5G 프리미어 에센셜', price: 85000 }, { category: '5G', name: '5G 프리미어 레귤러', price: 95000 }, { category: '5G', name: '5G 프리미어 플러스', price: 105000 }, { category: '5G', name: '5G 프리미어 슈퍼', price: 115000 }, { category: '5G', name: '5G 시그니처', price: 130000 }
];

const PLAN_FEATURES_U = {
  '데이터 일반':'300MB', '데이터 1.3':'1.3GB', '데이터 2.3':'2.3GB', '데이터 3.6':'3.6GB', '데이터 6.6':'6.6GB', '데이터 스페셜 A':'11GB + 일 2GB + 3Mbps', '데이터 스페셜 B':'16GB + 일 2GB + 3Mbps', 'LTE 데이터33':'1.5GB + 종량과금', 'LTE 추걱데44':'2.5GB + 400Kbps', 'LTE 추걱데49':'3.5GB + 1Mbps', 'LTE 추걱데59':'6.6GB + 1Mbps', 'LTE 추걱데69':'일 5GB + 5Mbps', 'LTE 속걱데78':'무제한', 'LTE 속걱데88':'무제한/스마트기기 2회선 무료', 'LTE 프리미어 에센셜':'무제한', 'LTE 프리미어 플러스':'무제한/스마트기기 2회선 무료',
  '5G 시니어 A형': '10GB + 1Mbps/만 65세 이상~만 70세 미만', '5G 시니어 B형': '10GB + 1Mbps/만 70세 이상~만 80세 미만', '5G 시니어 C형': '10GB + 1Mbps/만 80세 이상',
  '5G 미니':'5GB + 400Kbps/유쓰 데이터 제공량 9GB', '5G 슬림+':'9GB + 400Kbps/유쓰 데이터 제공량 15GB', '5G 라이트+':'14GB + 1Mbps/유쓰 데이터 제공량 26GB', '5G 베이직+':'24GB + 1Mbps/유쓰 데이터 제공량 36GB', '5G 심플+':'31GB + 1Mbps/유쓰 데이터 제공량 41GB', '5G 데이터 레귤러':'50GB + 1Mbps/유쓰 데이터 제공량 70GB', '5G 데이터 플러스':'80GB + 1Mbps/유쓰 데이터 제공량 110GB', '5G 데이터 슈퍼':'95GB + 3Mbps/유쓰 데이터 제공량 135GB', '5G 스탠다드 에센셜':'125GB + 5Mbps/유쓰 데이터 제공량 185GB', '5G 스탠다드':'150GB + 5Mbps/유쓰 데이터 제공량 210GB', '5G 프리미어 에센셜':'무제한', '5G 프리미어 레귤러':'무제한/스마트기기 요금할인 11,000원(1대)', '5G 프리미어 플러스':'무제한/스마트기기 요금할인 11,000원(2대)', '5G 프리미어 슈퍼':'무제한/스마트기기 요금할인 11,000원(2대)', '5G 시그니처':'무제한/스마트기기 요금할인 11,000원(2대)/미성년자 휴대폰 1대 33,000원 할인'
};

// ------ 이름 정규화: 괄호 제거 + 스페셜 A/B 보정 ------
function normalizePlanKey(name) {
  let n = (name || '').replace(/\(.*?\)/g, '').trim();
  if (n === '스페셜 A') n = '데이터 스페셜 A';
  if (n === '스페셜 B') n = '데이터 스페셜 B';
  return n;
}

// ------------------ 계산기 컴포넌트 ------------------
function Calculator({ plans, features, operator }) {
  const [selectedDevice, setSelectedDevice] = useState(CATEGORIZED_DEVICE_LIST[0].devices[0].name);
  const [selectedPlan, setSelectedPlan] = useState(plans[0].name);
  const [installMonths, setInstallMonths] = useState(24);
  const [interestRate] = useState(0.059);
  const [commonSupport, setCommonSupport] = useState(300000);
  const [additionalSupport, setAdditionalSupport] = useState(0);
  const [additionalEdited, setAdditionalEdited] = useState(false);
  const [preDiscount, setPreDiscount] = useState(0);
  const [contractType, setContractType] = useState('공통지원');
  const [memo, setMemo] = useState('');

  useEffect(() => {
    setSelectedPlan(plans[0]?.name || '');
  }, [plans]);
  
  useEffect(() => {
    if (contractType === '선택약정') {
      setAdditionalSupport(0);
      setAdditionalEdited(false);
      return;
    }
    if (operator === 'KT' && contractType === '공통지원') {
      const calculatedSupport = Math.floor((commonSupport * 0.15) / 100) * 100;
      if (!additionalEdited) {
        setAdditionalSupport(calculatedSupport);
      }
    }
  }, [commonSupport, contractType, operator, additionalEdited]);

  const devicePrice = useMemo(()=> DEVICE_LIST.find(d=>d.name===selectedDevice)?.price || 0, [selectedDevice]);

  const originalPlanPrice = useMemo(() => {
    return plans.find(p => p.name === selectedPlan)?.price || 0;
  }, [selectedPlan, plans]);

  const monthlyPlanDiscount = useMemo(() => {
    return Math.round(originalPlanPrice * 0.25);
  }, [originalPlanPrice]);
  
  const totalPlanDiscount = useMemo(() => {
    return monthlyPlanDiscount * 24;
  }, [monthlyPlanDiscount]);

  const totalDiscountDisplay = useMemo(() => {
    if (contractType === '공통지원') {
      return commonSupport + additionalSupport + preDiscount;
    } else {
      return preDiscount + totalPlanDiscount;
    }
  }, [contractType, commonSupport, additionalSupport, preDiscount, totalPlanDiscount]);

  const totalDiscountElement = useMemo(() => {
    if (contractType === '선택약정') {
      return (
        <span>
          - {totalDiscountDisplay.toLocaleString()}원
          <span className="text-sm font-normal ml-2 text-gray-600">
            (선할인 {preDiscount.toLocaleString()}원 + 통신요금 25% 할인 월 {monthlyPlanDiscount.toLocaleString()}원 (총 {totalPlanDiscount.toLocaleString()}원))
          </span>
        </span>
      );
    }
    return <span>- {totalDiscountDisplay.toLocaleString()}원</span>;
  }, [contractType, totalDiscountDisplay, preDiscount, monthlyPlanDiscount, totalPlanDiscount]);

  const finalDevicePrice = useMemo(() => {
    let totalDeviceDiscount = preDiscount; 
    if (contractType === '공통지원') {
      totalDeviceDiscount += commonSupport + additionalSupport;
    }
    return devicePrice - totalDeviceDiscount;
  }, [devicePrice, commonSupport, additionalSupport, preDiscount, contractType]);

  const monthlyDevice = useMemo(()=>{
    if(installMonths === 0) return 0;
    const principal = finalDevicePrice > 0 ? finalDevicePrice : 0;
    return Math.round(pmt(interestRate/12, installMonths, principal));
  }, [finalDevicePrice, installMonths, interestRate]);
    
  const totalRepayment = useMemo(() => {
    if (installMonths === 0) return finalDevicePrice > 0 ? finalDevicePrice : 0;
    return monthlyDevice * installMonths;
  }, [monthlyDevice, installMonths, finalDevicePrice]);

  const totalInterest = useMemo(() => {
    if (installMonths === 0) return 0;
    const interest = totalRepayment - (finalDevicePrice > 0 ? finalDevicePrice : 0);
    return interest > 0 ? Math.round(interest) : 0;
  }, [totalRepayment, finalDevicePrice, installMonths]);

  const planPrice = useMemo(()=>{
    let price = originalPlanPrice;
    if(contractType==='선택약정') price = Math.round(price * 0.75);
    return price;
  }, [originalPlanPrice, contractType]);

  const featureText = useMemo(()=>{
    const normalized = normalizePlanKey(selectedPlan);
    return features[normalized] || '';
  }, [selectedPlan, features]);

  const totalMonthly = monthlyDevice + planPrice;

  const handleFocus = (e) => e.target.select();
  
  return (
    <div className="p-4 max-w-4xl mx-auto">
      <div className="mb-4 flex flex-wrap gap-4">
        <select value={selectedDevice} onChange={e=>setSelectedDevice(e.target.value)} className="border p-2 rounded flex-1 min-w-0">
          {CATEGORIZED_DEVICE_LIST.map(group => (
            <optgroup key={group.category} label={group.category}>
              {group.devices.map(d => (
                <option key={d.name} value={d.name}>
                  {d.name} ({d.price.toLocaleString()}원)
                </option>
              ))}
            </optgroup>
          ))}
        </select>
        <select value={selectedPlan} onChange={e=>setSelectedPlan(e.target.value)} className="border p-2 rounded flex-1 min-w-0">
          {['LTE','시니어','Y','5G'].map(cat=>{
            const filtered = plans.filter(p=>p.category===cat);
            if(filtered.length===0) return null;
            return (
              <optgroup key={cat} label={cat}>
                {filtered.map(p=><option key={p.name} value={p.name}>{p.name} ({p.price.toLocaleString()}원)</option>)}
              </optgroup>
            );
          })}
        </select>
        <select value={installMonths} onChange={e=>setInstallMonths(Number(e.target.value))} className="border p-2 rounded w-32">
          {[0,6,12,18,24,30,36,48].map(m=><option key={m} value={m}>{m===0?'일시불':m+'개월'}</option>)}
        </select>
      </div>

      <div className="mb-4 flex flex-wrap items-end gap-4">
        <div className="flex flex-col">
          <label className="text-sm">공통지원금</label>
          {/* ▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼▼ */}
          {/* 수정된 부분: 공통지원금 변경 시, 추가지원금을 다시 자동계산하도록 로직을 수정합니다. */}
          <input 
            type="text" 
            inputMode="numeric"
            value={contractType==='선택약정' ? 0 : commonSupport} 
            disabled={contractType==='선택약정'} 
            onChange={e => {
              const v = Number(e.target.value.replace(/\D/g, '')) || 0;
              setCommonSupport(v);
              setAdditionalEdited(false); // 수동입력 상태를 해제하여 재계산을 허용
            }} 
            onFocus={handleFocus}
            className="border p-1 rounded w-32"
          />
          {/* ▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲▲ */}
        </div>
        <div className="flex flex-col">
          <label className="text-sm">추가지원금</label>
          <input 
            type="text" 
            inputMode="numeric"
            value={contractType==='선택약정' ? 0 : additionalSupport} 
            disabled={contractType==='선택약정'} 
            onChange={e => {
              const v = Number(e.target.value.replace(/\D/g, '')) || 0;
              setAdditionalSupport(v);
              setAdditionalEdited(true); // 수동으로 입력했음을 표시
            }} 
            onFocus={handleFocus}
            className="border p-1 rounded w-32"
          />
        </div>
        <div className="flex flex-col">
          <label className="text-sm">선할인</label>
          <input 
            type="text" 
            inputMode="numeric"
            value={preDiscount} 
            onChange={e => setPreDiscount(Number(e.target.value.replace(/\D/g, '')) || 0)} 
            onFocus={handleFocus}
            className="border p-1 rounded w-32"
          />
        </div>
        <div className="flex flex-col">
          <label className="text-sm mb-1">약정</label>
          <div className="flex border rounded overflow-hidden h-[26px]">
            <label className="relative flex-1">
              <input
                type="radio"
                name="contractType"
                value="공통지원"
                checked={contractType === '공통지원'}
                onChange={e => setContractType(e.target.value)}
                className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
              />
              <div
                className={`flex items-center justify-center h-full px-3 text-xs transition-colors ${
                  contractType === '공통지원' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'
                }`}
              >
                공통지원
              </div>
            </label>
            <div className="border-l"></div>
            <label className="relative flex-1">
              <input
                type="radio"
                name="contractType"
                value="선택약정"
                checked={contractType === '선택약정'}
                onChange={e => setContractType(e.target.value)}
                className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
              />
              <div
                className={`flex items-center justify-center h-full px-3 text-xs transition-colors ${
                  contractType === '선택약정' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'
                }`}
              >
                선택약정
              </div>
            </label>
          </div>
        </div>
      </div>

      <div className="border p-4 rounded bg-white shadow-md flex flex-col gap-2">
        <div className="text-black font-bold text-xl">단말기 출고가: {devicePrice.toLocaleString()}원</div>
        <div className="text-red-600 font-bold text-xl">총 할인액: {totalDiscountElement}</div>
        <div className="text-green-600 font-bold text-xl">
          단말기 할부원금: {(finalDevicePrice > 0 ? finalDevicePrice : 0).toLocaleString()}원
          {installMonths > 0 && finalDevicePrice > 0 && (
            <span className="text-sm font-normal ml-2 text-gray-600">
              (총 이자: {totalInterest.toLocaleString()}원, 총 상환액: {totalRepayment.toLocaleString()}원)
            </span>
          )}
        </div>
        <div className="text-blue-600 font-bold text-xl">월 할부금(할부이자 5.9% 포함): {monthlyDevice.toLocaleString()}원</div>
        <div className="text-blue-600 font-bold text-xl">월 통신요금: {planPrice.toLocaleString()}원 {featureText && <span className="text-gray-600 text-sm">({featureText})</span>}</div>
        <div className="text-black-600 font-bold text-2xl">월 납부 예상금액: {totalMonthly.toLocaleString()}원</div>
      </div>
      
      <div className="mt-4">
        <label htmlFor="memo-area" className="block text-sm font-medium text-gray-700 mb-1">상담 메모</label>
        <textarea
          id="memo-area"
          value={memo}
          onChange={e => setMemo(e.target.value)}
          rows="6"
          className="p-2 border rounded shadow-sm w-full focus:ring-blue-500 focus:border-blue-500"
          placeholder="퇴근하고싶다"
        ></textarea>
      </div>

    </div>
  );
}

// ------------------ 렌더링 ------------------
function App() {
  const [operator, setOperator] = useState('KT');
  const [trackingNumber, setTrackingNumber] = useState('');

  const handleTrackingSearch = () => {
    if (!trackingNumber || !/^\d+$/.test(trackingNumber)) {
      alert('숫자로 된 송장번호를 입력해주세요.');
      return;
    }
    const url = `https://www.cjlogistics.com/ko/tool/parcel/tracking?gnbInvcNo=${trackingNumber}`;
    const popupFeatures = 'width=1600,height=900,scrollbars=yes,resizable=yes';
    window.open(url, 'cjTrackingPopup', popupFeatures);
    setTrackingNumber(''); 
  };

  const plans = useMemo(()=> operator==='KT'?PLAN_LIST_KT:PLAN_LIST_U, [operator]);
  const features = useMemo(()=> operator==='KT'?PLAN_FEATURES_KT:PLAN_FEATURES_U, [operator]);

  return (
    <div>
      <div className="p-4 max-w-4xl mx-auto flex flex-wrap gap-4 items-center">
        <button
          className={`p-2 rounded ${operator === 'KT' ? 'bg-blue-600 text-white' : 'bg-white border'}`}
          onClick={() => setOperator('KT')}
        >
          KT
        </button>
        <button
          className={`p-2 rounded ${operator === 'U' ? 'bg-green-600 text-white' : 'bg-white border'}`}
          onClick={() => setOperator('U')}
        >
          U+
        </button>

        {operator === 'KT' && (
          <a
            href="https://shop.kt.com/mobile/products.do?&=&category=mobile"
            target="_blank"
            rel="noopener noreferrer"
            className="ml-4 bg-blue-500 text-white px-3 py-2 rounded hover:bg-blue-600"
          >
            KT닷컴
          </a>
        )}

        {operator === 'U' && (
          <a
            href="https://www.lguplus.com/mobile/device/phone"
            target="_blank"
            rel="noopener noreferrer"
            className="ml-4 bg-green-500 text-white px-3 py-2 rounded hover:bg-green-600"
          >
            U+닷컴
          </a>
        )} 

        <div className="flex items-center ml-4">
          <a
            href="https://www.samsung.com/sec/smartphones/all-smartphones/?carrier-phone"
            target="_blank"
            rel="noopener noreferrer"
            className="bg-gray-800 text-white px-3 py-2 rounded hover:bg-gray-900"
          >
            삼성닷컴
          </a>
        </div>
        
        <div className="flex items-center ml-auto gap-2">
          <input
            type="text"
            value={trackingNumber}
            onChange={(e) => {
              const value = e.target.value.replace(/\D/g, '');
              setTrackingNumber(value);
            }}
            onKeyDown={(e) => {
              if (e.key === 'Enter') {
                handleTrackingSearch();
              }
            }}
            placeholder="CJ대한통운 송장번호"
            className="border p-2 rounded w-48 h-[40px]"
          />
          <button
            onClick={handleTrackingSearch}
            className="bg-amber-500 text-white px-3 py-2 rounded hover:bg-amber-600 h-[40px]"
          >
            배송조회
          </button>
        </div>
      </div>

      <Calculator plans={plans} features={features} operator={operator} />
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);

</script>
</body>
</html>
